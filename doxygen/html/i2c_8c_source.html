<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PIC SoftAP: C:/Users/krs/Google Drev/ProjectNet/Projekter/MPLABXProjects/SoftAP_webserver.X/i2c.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">PIC SoftAP
   &#160;<span id="projectnumber">1.00-development</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('i2c_8c_source.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">C:/Users/krs/Google Drev/ProjectNet/Projekter/MPLABXProjects/SoftAP_webserver.X/i2c.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="i2c_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> * Device            :  PIC18F26K22</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> * Driver Version    :  2.00</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160; </div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="preprocessor">#ifndef MCC_H</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="preprocessor">    #include &quot;mcc_generated_files/mcc.h&quot;</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="preprocessor">#ifndef I2C_H</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor">    #include &quot;<a class="code" href="i2c_8h.html">i2c.h</a>&quot;</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#ifndef ESP8266_H </span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">    #include &quot;<a class="code" href="esp8266_8h.html">esp8266.h</a>&quot;</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#ifndef TCPIP_H</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">    #include &quot;<a class="code" href="tcpip_8h.html">tcpip.h</a>&quot;</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">//#ifndef EEPROM_H</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">//    #include &quot;eeprom.h&quot;</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment">//#endif</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">//#ifndef RTC_H</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment">//    #include &quot;rtc.h&quot;</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment">//#endif</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160; </div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160; </div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &lt;stdint.h&gt;</span>        <span class="comment">/* For uint8_t definition */</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &lt;stdbool.h&gt;</span>       <span class="comment">/* For true/false definition */</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &lt;ctype.h&gt;</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160; </div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment">//#define debug</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160; </div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment">/**************************************************************</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment">                   I2C generelle kommandoer </span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment"> **************************************************************/</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#ifndef I2C_C</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160; </div>
<div class="line"><a name="l00038"></a><span class="lineno"><a class="line" href="i2c_8h.html#a5730d9445429351b9f750084c5cb5aae">   38</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="i2c_8c.html#a5730d9445429351b9f750084c5cb5aae">i2c_init</a>(<span class="keywordtype">void</span>) {</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#ifdef debug</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    <a class="code" href="esp8266_8c.html#aa5e1cb340835d3ac9cb4c407ca03c1a2">esp_terminalTransmit</a>(<span class="stringliteral">&quot;Initialiserer I2C bussen\r\n&quot;</span>);</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    </div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    TRISCbits.RC3=1;</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    TRISCbits.RC4=1;</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160; </div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    ANSELCbits.ANSC3 = 0;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    ANSELCbits.ANSC4 = 0;</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;            </div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    <span class="comment">//uint8_t i2c_clock = (_XTAL_FREQ /(4 * 100000)) - 1; // Sætter hastigheden til 100K for I2C bussen #9</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    </div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    SSP1ADD  = 0x9F; <span class="comment">//i2c_clock; //SSP1ADD = 0x9F ved 16MHz x 4 software pll</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    SSP1CON1 = 0x28;<span class="comment">//0b00101000; // 0x28</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    SSP1CON2 = 0;</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;}</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160; </div>
<div class="line"><a name="l00056"></a><span class="lineno"><a class="line" href="i2c_8h.html#a1b96df492284070c5fb8ac5daa5a53a1">   56</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="i2c_8c.html#a1b96df492284070c5fb8ac5daa5a53a1">i2c_portScan</a>(<span class="keywordtype">void</span>) {</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    <span class="keywordflow">for</span>(uint8_t i=0 ; i&lt;0x7F; i++) {</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;        printf(<span class="stringliteral">&quot;Scanner addresse: 0x%02X&quot;</span>, i);</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;        <a class="code" href="i2c_8c.html#a2afd8da70c8c74e56659da3dd6f60dd0">i2c_write_serial</a>(i, 0, 1);</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    }       </div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;}</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160; </div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160; </div>
<div class="line"><a name="l00064"></a><span class="lineno"><a class="line" href="i2c_8h.html#ad44071ec6f7a4af5371efcabba402897">   64</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="i2c_8c.html#a2afd8da70c8c74e56659da3dd6f60dd0">i2c_write_serial</a>(uint8_t addr, <span class="keywordtype">char</span> *data, uint8_t length) {</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <span class="keywordtype">char</span> msg[50];</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    </div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    uint8_t targetAddr = addr&lt;&lt;1; <span class="comment">// Laver addressen om til 8 bit med WRITE condition</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="preprocessor">    #ifdef debug</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;        <a class="code" href="esp8266_8c.html#aa5e1cb340835d3ac9cb4c407ca03c1a2">esp_terminalTransmit</a>(<span class="stringliteral">&quot;\r\n***********WRITE****************\r\n&quot;</span>);</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="preprocessor">    #endif</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    </div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <a class="code" href="i2c_8c.html#adb646b67ce754741a06e63ea28d05259">i2c_master_wait</a>();</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <a class="code" href="i2c_8c.html#a02d93c2bcdbbee7a791b77b0cf12467f">i2c_master_start</a>();</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    </div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    SSP1BUF = targetAddr;</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    <span class="keywordflow">while</span>(SSP1STATbits.R_nW);</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160; </div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <span class="keywordflow">if</span>( SSP1CON2bits.ACKSTAT == 0 ) {</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="preprocessor">        #ifdef debug</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;            sprintf(msg, <span class="stringliteral">&quot;ACK - Skrev adresse: 0x%02X\r\n&quot;</span>, targetAddr);</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;            <a class="code" href="esp8266_8c.html#aa5e1cb340835d3ac9cb4c407ca03c1a2">esp_terminalTransmit</a>(msg);</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="preprocessor">        #endif</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160; </div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;        <span class="keywordflow">for</span> (uint8_t i=0; i &lt; length ; i++) {</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="preprocessor">            #ifdef debug</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;                sprintf(msg, <span class="stringliteral">&quot;Data: 0x%02X\r\n&quot;</span>, data[i]);</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;                <a class="code" href="esp8266_8c.html#aa5e1cb340835d3ac9cb4c407ca03c1a2">esp_terminalTransmit</a>(msg);</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="preprocessor">            #endif</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;            SSP1BUF = (uint8_t) data[i];</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;            <span class="keywordflow">while</span>(SSP1STATbits.R_nW);</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160; </div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;            <span class="keywordflow">if</span>( SSP1CON2bits.ACKSTAT == 0 ) { <span class="comment">// Hvis vi får en Acknowledge</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="preprocessor">                #ifdef debug</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;                    sprintf(msg, <span class="stringliteral">&quot;ACK - Skrev data: 0x%02X - %c\r\n&quot;</span>, data[i], data[i]);</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;                    <a class="code" href="esp8266_8c.html#aa5e1cb340835d3ac9cb4c407ca03c1a2">esp_terminalTransmit</a>(msg);</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="preprocessor">                #endif</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="preprocessor">                #ifdef debug</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;                    <a class="code" href="esp8266_8c.html#aa5e1cb340835d3ac9cb4c407ca03c1a2">esp_terminalTransmit</a>(<span class="stringliteral">&quot;NACK - gensender\r\n&quot;</span>);</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="preprocessor">                #endif</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;                SSP1CON2bits.RCEN=1;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;                <span class="keywordflow">while</span>(SSP1CON2bits.RCEN==1);</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160; </div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;                SSP1BUF = (uint8_t) data[i];</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;                <span class="keywordflow">while</span>(SSP1STATbits.R_nW);</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160; </div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;                <span class="keywordflow">if</span>(SSP1CON2bits.ACKSTAT == 0) {</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="preprocessor">                    #ifdef debug</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;                        sprintf(msg, <span class="stringliteral">&quot;ACK - Skrev data: 0x%02X - %c\r\n&quot;</span>, data[i], data[i]);</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;                        <a class="code" href="esp8266_8c.html#aa5e1cb340835d3ac9cb4c407ca03c1a2">esp_terminalTransmit</a>(msg);</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="preprocessor">                    #endif</span></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="preprocessor">                    #ifdef debug</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;                        <a class="code" href="esp8266_8h.html#a4952c1b7f3ed488d08e34f466ba70db8">states</a>.<a class="code" href="struct_states.html#a15c190cd300d7947b7cdc7fd677d7a52">error</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;                        <a class="code" href="esp8266_8c.html#aa5e1cb340835d3ac9cb4c407ca03c1a2">esp_terminalTransmit</a>(<span class="stringliteral">&quot;NACK - Fejl i skrivning af data\r\n&quot;</span>);</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="preprocessor">                    #endif</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;                }</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;            }</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;        }</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;        </div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        <a class="code" href="i2c_8c.html#a4524baa32fdd90e664342c610dc1d177">i2c_master_stop</a>();</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160; </div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="preprocessor">        #ifdef debug</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;            sprintf(msg, <span class="stringliteral">&quot;Kunne ikke finde enhed p&amp;#230; adresse: 0x%02X %u\r\n&quot;</span>, targetAddr, targetAddr);</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;            <a class="code" href="esp8266_8c.html#aa5e1cb340835d3ac9cb4c407ca03c1a2">esp_terminalTransmit</a>(msg);</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="preprocessor">        #endif</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    }</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="preprocessor">    #ifdef debug</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        <a class="code" href="esp8266_8c.html#aa5e1cb340835d3ac9cb4c407ca03c1a2">esp_terminalTransmit</a>(<span class="stringliteral">&quot;********************************\r\n&quot;</span>);</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="preprocessor">    #endif</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;}</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160; </div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160; </div>
<div class="line"><a name="l00135"></a><span class="lineno"><a class="line" href="i2c_8h.html#a5cb803da522d50c9cdb9eaeb473e625a">  135</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="i2c_8c.html#abeb4d291e6ada6f8ad8cdfde914e92ab">i2c_read_serial</a>(uint8_t addr, uint8_t *<a class="code" href="i2c_8h.html#a8eac694cd48788e914ae973b41d1b8ec">data_out</a>, uint8_t length) {</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <span class="keywordtype">char</span> msg[50];</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    uint8_t targetAddr = (addr&lt;&lt;1)+1; <span class="comment">// Laver addressen om til 8 bit med READ condition</span></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    </div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="preprocessor">    #ifdef debug</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;        <a class="code" href="esp8266_8c.html#aa5e1cb340835d3ac9cb4c407ca03c1a2">esp_terminalTransmit</a>(<span class="stringliteral">&quot;\r\n***********READ*****************\r\n&quot;</span>);</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="preprocessor">    #endif</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    </div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <a class="code" href="i2c_8c.html#adb646b67ce754741a06e63ea28d05259">i2c_master_wait</a>();</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    <a class="code" href="i2c_8c.html#a02d93c2bcdbbee7a791b77b0cf12467f">i2c_master_start</a>();</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    </div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    SSP1BUF = targetAddr; <span class="comment">// Skriver sdressen</span></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="preprocessor">    #ifdef debug</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        sprintf(msg, <span class="stringliteral">&quot;Skriver: adresse: 0x%02X\n\r&quot;</span>, targetAddr);</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;        <a class="code" href="esp8266_8c.html#aa5e1cb340835d3ac9cb4c407ca03c1a2">esp_terminalTransmit</a>(msg);</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="preprocessor">    #endif</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    </div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <span class="keywordflow">if</span>(SSP1CON2bits.ACKSTAT == 0) {</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;        <span class="keywordflow">for</span> (uint8_t i=0; i &lt; length ; i++) {</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;            SSP1CON2bits.RCEN = 1;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;            <span class="keywordflow">while</span>(SSP1CON2bits.RCEN) {};</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;            </div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;            <a class="code" href="i2c_8h.html#a8eac694cd48788e914ae973b41d1b8ec">data_out</a>[i] = SSP1BUF;</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;            </div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;            <span class="comment">// Sender ACK eller NACK til sidst</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;            <span class="keywordflow">if</span>( i != length -1)<span class="comment">// Sender ACK eller NACK til sidst</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;                <a class="code" href="i2c_8c.html#a6caad88441987f83268d336d4322d07d">i2c_master_ack</a>();</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;                <a class="code" href="i2c_8c.html#ae60d3dfb3e2bcfacd1bbca9debd6e35c">i2c_master_nack</a>();</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;           </div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;            SSP1CON2bits.ACKEN = 1;</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;            <span class="keywordflow">while</span>(SSP1CON2bits.ACKEN == 1)</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;                ;</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;            </div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;<span class="preprocessor">            #ifdef debug</span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;                sprintf(msg, <span class="stringliteral">&quot;Laeste: 0x%02X %c\n\r&quot;</span>, <a class="code" href="i2c_8h.html#a8eac694cd48788e914ae973b41d1b8ec">data_out</a>[i], <a class="code" href="i2c_8h.html#a8eac694cd48788e914ae973b41d1b8ec">data_out</a>[i]);</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;                <a class="code" href="esp8266_8c.html#aa5e1cb340835d3ac9cb4c407ca03c1a2">esp_terminalTransmit</a>(msg);</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;<span class="preprocessor">            #endif</span></div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;        }</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;        </div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;        <span class="comment">// Sender NACK</span></div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;        <a class="code" href="i2c_8c.html#ae60d3dfb3e2bcfacd1bbca9debd6e35c">i2c_master_nack</a>();</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;        <a class="code" href="i2c_8c.html#a4524baa32fdd90e664342c610dc1d177">i2c_master_stop</a>();</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160; </div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;<span class="preprocessor">        #ifdef debug</span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;            <a class="code" href="esp8266_8c.html#aa5e1cb340835d3ac9cb4c407ca03c1a2">esp_terminalTransmit</a>(<span class="stringliteral">&quot;Kunne ikke finde enhed\r\n&quot;</span>);</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;<span class="preprocessor">        #endif</span></div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    }</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="preprocessor">    #ifdef debug</span></div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        <a class="code" href="esp8266_8c.html#aa5e1cb340835d3ac9cb4c407ca03c1a2">esp_terminalTransmit</a>(<span class="stringliteral">&quot;********************************\r\n&quot;</span>);</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;<span class="preprocessor">    #endif</span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;}</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160; </div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160; </div>
<div class="line"><a name="l00190"></a><span class="lineno"><a class="line" href="i2c_8h.html#adb646b67ce754741a06e63ea28d05259">  190</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="i2c_8c.html#adb646b67ce754741a06e63ea28d05259">i2c_master_wait</a>(<span class="keywordtype">void</span>) {</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    <span class="keywordflow">while</span> ( (SSP1STAT &amp; 0x04) || (SSP1CON2 &amp; 0x1F) )</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;        ;</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;<span class="preprocessor">    #ifdef debug</span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        <a class="code" href="esp8266_8c.html#aa5e1cb340835d3ac9cb4c407ca03c1a2">esp_terminalTransmit</a>(<span class="stringliteral">&quot;Bussen er klar\r\n&quot;</span>);</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;<span class="preprocessor">    #endif</span></div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;}</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160; </div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160; </div>
<div class="line"><a name="l00199"></a><span class="lineno"><a class="line" href="i2c_8h.html#a02d93c2bcdbbee7a791b77b0cf12467f">  199</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="i2c_8c.html#a02d93c2bcdbbee7a791b77b0cf12467f">i2c_master_start</a>(<span class="keywordtype">void</span>) {</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    SSP1CON2bits.SEN = 1;</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <span class="keywordflow">while</span>(SSP1CON2bits.SEN == 1)</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;        ;</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;<span class="preprocessor">    #ifdef debug</span></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        <a class="code" href="esp8266_8c.html#aa5e1cb340835d3ac9cb4c407ca03c1a2">esp_terminalTransmit</a>(<span class="stringliteral">&quot;Har sendt start\r\n&quot;</span>);</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;<span class="preprocessor">    #endif</span></div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;}</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160; </div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160; </div>
<div class="line"><a name="l00209"></a><span class="lineno"><a class="line" href="i2c_8h.html#a4524baa32fdd90e664342c610dc1d177">  209</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="i2c_8c.html#a4524baa32fdd90e664342c610dc1d177">i2c_master_stop</a>(<span class="keywordtype">void</span>) {</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    SSP1CON2bits.PEN = 1;</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    <span class="keywordflow">while</span>(SSP1CON2bits.PEN == 1)</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;        ;</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;<span class="preprocessor">    #ifdef debug</span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;        <a class="code" href="esp8266_8c.html#aa5e1cb340835d3ac9cb4c407ca03c1a2">esp_terminalTransmit</a>(<span class="stringliteral">&quot;Har sendt stop\r\n&quot;</span>);</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="preprocessor">    #endif</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;}</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160; </div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160; </div>
<div class="line"><a name="l00219"></a><span class="lineno"><a class="line" href="i2c_8h.html#a6caad88441987f83268d336d4322d07d">  219</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="i2c_8c.html#a6caad88441987f83268d336d4322d07d">i2c_master_ack</a>(<span class="keywordtype">void</span>) {</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    SSP1CON2bits.ACKDT = 0;</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    SSP1CON2bits.ACKEN = 1;</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    <span class="keywordflow">while</span>(SSP1CON2bits.ACKEN == 1);</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;}</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160; </div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160; </div>
<div class="line"><a name="l00226"></a><span class="lineno"><a class="line" href="i2c_8h.html#ae60d3dfb3e2bcfacd1bbca9debd6e35c">  226</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="i2c_8c.html#ae60d3dfb3e2bcfacd1bbca9debd6e35c">i2c_master_nack</a>(<span class="keywordtype">void</span>) {</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    SSP1CON2bits.ACKDT = 1;</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    SSP1CON2bits.ACKEN = 1;</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    <span class="keywordflow">while</span>(SSP1CON2bits.ACKEN == 1);</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;}</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160; </div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160; </div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160; </div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="comment">/**************************************************************/</span></div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/*I2C_C*/</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160; </div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160; </div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160; </div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;<span class="comment">/**************************************************************</span></div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="comment">                  LCD generelle kommandoer </span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;<span class="comment"> **************************************************************/</span></div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;<span class="preprocessor">#ifndef DISPLAY_C</span></div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160; </div>
<div class="line"><a name="l00244"></a><span class="lineno"><a class="line" href="i2c_8c.html#a47c73631070ab0c6b9e7574163b90d87">  244</a></span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span> <a class="code" href="i2c_8c.html#a47c73631070ab0c6b9e7574163b90d87">empty_line</a>[] = <span class="stringliteral">&quot;                &quot;</span>;</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160; </div>
<div class="line"><a name="l00246"></a><span class="lineno"><a class="line" href="i2c_8h.html#ac69b8d8de566fa9d1ec2a74518e70af1">  246</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="i2c_8c.html#ac69b8d8de566fa9d1ec2a74518e70af1">i2c_lcd_displayInit</a>(<span class="keywordtype">void</span>) {</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;<span class="preprocessor">    #ifdef debug</span></div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;        <a class="code" href="esp8266_8c.html#aa5e1cb340835d3ac9cb4c407ca03c1a2">esp_terminalTransmit</a>(<span class="stringliteral">&quot;Initialiserer I2C bussen\r\n&quot;</span>);</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;<span class="preprocessor">    #endif</span></div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    <a class="code" href="i2c_8c.html#a2afd8da70c8c74e56659da3dd6f60dd0">i2c_write_serial</a>(<a class="code" href="i2c_8h.html#a8683f936ecb5cd7b43c33a01a435a7ba">display_addr</a>, <a class="code" href="i2c_8h.html#aac625d7a605ca9aca6a1775119fc307d">display_init</a>, 10);</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    <a class="code" href="i2c_8c.html#a2afd8da70c8c74e56659da3dd6f60dd0">i2c_write_serial</a>(<a class="code" href="i2c_8h.html#a8683f936ecb5cd7b43c33a01a435a7ba">display_addr</a>, <a class="code" href="i2c_8h.html#a2190e3cca1f36422ffbff3de09bccbec">first_line</a>, 2);</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    <a class="code" href="i2c_8c.html#a2afd8da70c8c74e56659da3dd6f60dd0">i2c_write_serial</a>(<a class="code" href="i2c_8h.html#a8683f936ecb5cd7b43c33a01a435a7ba">display_addr</a>, <a class="code" href="i2c_8c.html#a47c73631070ab0c6b9e7574163b90d87">empty_line</a>, 16);</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    </div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    <a class="code" href="i2c_8c.html#a2afd8da70c8c74e56659da3dd6f60dd0">i2c_write_serial</a>(<a class="code" href="i2c_8h.html#a8683f936ecb5cd7b43c33a01a435a7ba">display_addr</a>, <a class="code" href="i2c_8h.html#a7c8aec3447e717abf7f853bd11b8a5ec">shift_line</a>, 2);</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    <a class="code" href="i2c_8c.html#a2afd8da70c8c74e56659da3dd6f60dd0">i2c_write_serial</a>(<a class="code" href="i2c_8h.html#a8683f936ecb5cd7b43c33a01a435a7ba">display_addr</a>, <a class="code" href="i2c_8c.html#a47c73631070ab0c6b9e7574163b90d87">empty_line</a>, 16);</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;}</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160; </div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;<span class="comment">// Funktion som skriver tekst på LCD, med linie og position</span></div>
<div class="line"><a name="l00259"></a><span class="lineno"><a class="line" href="i2c_8h.html#a09f42868296b4eb1f9c26a89885e282e">  259</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="i2c_8c.html#a2bb899e439501717070e41d0daf659c6">i2c_lcd_write</a>(<span class="keywordtype">char</span> *tmpmsg, uint8_t line, uint8_t pos) {</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    uint8_t posLcd[] = { 0x00, ((line == 2)?(0xC0 + pos):(0x80 + pos)) }; <span class="comment">// Beregn position</span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    <span class="keywordtype">char</span>    msg[30];</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    strcpy(msg, <a class="code" href="i2c_8c.html#a47c73631070ab0c6b9e7574163b90d87">empty_line</a>);</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    strcpy(msg, tmpmsg);</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    </div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    <a class="code" href="i2c_8c.html#a2afd8da70c8c74e56659da3dd6f60dd0">i2c_write_serial</a>(<a class="code" href="i2c_8h.html#a8683f936ecb5cd7b43c33a01a435a7ba">display_addr</a>, posLcd, 2);                 <span class="comment">// Indstil &quot;cursor&quot;</span></div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    <a class="code" href="i2c_8c.html#a2afd8da70c8c74e56659da3dd6f60dd0">i2c_write_serial</a>(<a class="code" href="i2c_8h.html#a8683f936ecb5cd7b43c33a01a435a7ba">display_addr</a>, tmpmsg, 16 ); <span class="comment">// og skriv besked</span></div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;}</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160; </div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160; </div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;<span class="comment">/**************************************************************/</span></div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160; </div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160; </div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160; </div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;<span class="comment">/**************************************************************</span></div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;<span class="comment">                       Temperatur sensor</span></div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;<span class="comment"> **************************************************************/</span></div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;<span class="preprocessor">#ifndef TEMP_C</span></div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160; </div>
<div class="line"><a name="l00280"></a><span class="lineno"><a class="line" href="i2c_8h.html#ab98870ccbc4924e9224e1efa8de12409">  280</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="i2c_8c.html#ab98870ccbc4924e9224e1efa8de12409">i2c_temp_testTempSensor</a>(<span class="keywordtype">void</span>) {</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    <a class="code" href="i2c_8c.html#a2afd8da70c8c74e56659da3dd6f60dd0">i2c_write_serial</a>(<a class="code" href="i2c_8h.html#abd4afcc16efaddacd3e1078677f09aea">temperature_addr</a>, 0, 0);</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    <a class="code" href="i2c_8c.html#abeb4d291e6ada6f8ad8cdfde914e92ab">i2c_read_serial</a>(<a class="code" href="i2c_8h.html#abd4afcc16efaddacd3e1078677f09aea">temperature_addr</a>, <a class="code" href="i2c_8h.html#a8eac694cd48788e914ae973b41d1b8ec">data_out</a>, 4);</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;}</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160; </div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160; </div>
<div class="line"><a name="l00286"></a><span class="lineno"><a class="line" href="i2c_8h.html#a0ffbc3618da77afeaec223450985ce49">  286</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="i2c_8c.html#a0ffbc3618da77afeaec223450985ce49">getReading</a>(<span class="keywordtype">void</span>) {</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    uint32_t tmp_moist = 0;</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    int32_t  tmp_temp  = 0;</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    uint8_t  length    = 0;</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160; </div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    <span class="comment">//Læs fra sensor</span></div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    <a class="code" href="i2c_8c.html#a2afd8da70c8c74e56659da3dd6f60dd0">i2c_write_serial</a>(<a class="code" href="i2c_8h.html#abd4afcc16efaddacd3e1078677f09aea">temperature_addr</a>, 0, 0);</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    <a class="code" href="i2c_8c.html#abeb4d291e6ada6f8ad8cdfde914e92ab">i2c_read_serial</a>(<a class="code" href="i2c_8h.html#abd4afcc16efaddacd3e1078677f09aea">temperature_addr</a>, <a class="code" href="i2c_8h.html#a8eac694cd48788e914ae973b41d1b8ec">data_out</a>, 4);</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;   </div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    tmp_moist  = ( <a class="code" href="i2c_8h.html#a8eac694cd48788e914ae973b41d1b8ec">data_out</a>[0] &amp; 0b00111111 ) &lt;&lt; 8;</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    tmp_moist += <a class="code" href="i2c_8h.html#a8eac694cd48788e914ae973b41d1b8ec">data_out</a>[1];</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    tmp_moist *= 100;</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    tmp_moist /= 16382;</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    </div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    <a class="code" href="i2c_8c.html#a801e6fe14e7cf1f1e51e219b8593c8d4">updateMoist</a>( (int8_t) tmp_moist);</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    </div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    <span class="comment">// Sensor er gyldig mellem -25 til 85 grader</span></div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    tmp_temp  = <a class="code" href="i2c_8h.html#a8eac694cd48788e914ae973b41d1b8ec">data_out</a>[2] &lt;&lt; 8;</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    tmp_temp += <a class="code" href="i2c_8h.html#a8eac694cd48788e914ae973b41d1b8ec">data_out</a>[3];</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    tmp_temp &gt;&gt;= 2;</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;        </div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    tmp_temp *= 16500;</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    tmp_temp /= 16382;</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    tmp_temp -= 4000;</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160; </div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    <span class="comment">// Indsætter start kommando: skriver tegn</span></div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    <a class="code" href="i2c_8h.html#a9eec345fbe35bae76df320fc80e492d6">tmp_string</a>[length++] = 0x40;</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    </div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    <span class="comment">// Vi tjekker om tallet er negativt</span></div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    <span class="keywordflow">if</span>(tmp_temp &lt; 0) {</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;        <a class="code" href="i2c_8h.html#a9eec345fbe35bae76df320fc80e492d6">tmp_string</a>[length++] = 0x2D;</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;        tmp_temp *= -1;</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    }</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    </div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    <span class="comment">// Måler på sidste ciffer 00,0x</span></div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    int8_t decimal2 = tmp_temp % 10;</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    tmp_temp /= 10;</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160; </div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    <span class="comment">// Måler på 2. sidste ciffer 00,x</span></div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    int8_t decimal1 = tmp_temp % 10;</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    </div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    <span class="keywordflow">if</span>(decimal2 &gt;= 5 ) {</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;        decimal1++;</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;        tmp_temp++;</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    }</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    </div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    tmp_temp /= 10;</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    </div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    <span class="comment">// Formatterer heltallet</span></div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    <span class="keywordflow">if</span>(tmp_temp &gt; 9) {</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;        uint8_t ones = (uint8_t) tmp_temp % 10;</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;        tmp_temp /= 10;</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;        uint8_t tens = (uint8_t) tmp_temp;</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;        </div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;        <a class="code" href="i2c_8h.html#a9eec345fbe35bae76df320fc80e492d6">tmp_string</a>[length++] = tens | 0b00110000; <span class="comment">// Laver tallet til ASCII</span></div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;        <a class="code" href="i2c_8h.html#a9eec345fbe35bae76df320fc80e492d6">tmp_string</a>[length++] = ones | 0b00110000; <span class="comment">// --&quot;--</span></div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;        <a class="code" href="i2c_8h.html#a9eec345fbe35bae76df320fc80e492d6">tmp_string</a>[length++] = tmp_temp;</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    }</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    </div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    <span class="comment">// Formatterer komma tal</span></div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    <a class="code" href="i2c_8h.html#a9eec345fbe35bae76df320fc80e492d6">tmp_string</a>[length++] = 0x2C; <span class="comment">//Komma tegn</span></div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    <a class="code" href="i2c_8h.html#a9eec345fbe35bae76df320fc80e492d6">tmp_string</a>[length++] = decimal1 | 0b00110000; <span class="comment">// Laver tallet til ASCII;</span></div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    </div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    <span class="comment">// Sætter gradtegn på     //tmp_string[length++] = 0xDF; // Eksisterende grad tegn
    tmp_string[length++] = 0x00;
    /*tmp_string[length++] = 0x01;
    tmp_string[length++] = 0x02;
    tmp_string[length++] = 0x03;
    tmp_string[length++] = 0x04;
    tmp_string[length++] = 0x05;
    tmp_string[length++] = 0x06;
    tmp_string[length++] = 0x07;*/

    i2c_write_serial(display_addr, temp_pos, 2);
    i2c_write_serial(display_addr, tmp_string, length);
}


void updateTemperature(int8_t temp) {
    if(temp &lt; 0) {
        i2c_write_serial(display_addr, temp_pos, 2);
        i2c_write_serial(display_addr, minus, 2);
        temp *= -1;
    } else if (temp &gt; 9) {
        uint8_t tens = (uint8_t) (temp / 10) | 0b00110000;
        uint8_t ones = (uint8_t) (temp % 10) | 0b00110000;        
        char    output[] = {0x40, tens , ones, 3};
        
        i2c_write_serial(display_addr, temp_pos, 2);
        i2c_write_serial(display_addr, output, 3);
    }
}


void updateMoist(uint8_t moist) {
    char output[20];
    output[0] = 0x40;
    
    if(moist &gt;= 100) {
        output[1] = 1;
        output[1] |= 0b00110000;
        moist -= 100;
    } else {
        output[1] = 0b10100000;
    }
    
    if(moist &gt;= 10) {
        output[2] = (moist / 10) | 0b00110000;
        output[3] = (moist % 10) | 0b00110000;
    } else {
        output[1] = 0b10100000;
        output[2] = 0b10100000;
        output[3] = moist | 0b00110000;
    }

    i2c_write_serial(display_addr, moist_pos, 2);
    i2c_write_serial(display_addr, output, 4);
}


/**************************************************************/
#endif



/**************************************************************
                            EEPROM
 **************************************************************/
#ifndef EEPROM_C



void i2c_eeprom_testData(void) {
#ifdef debug
    printf(&quot;Skriv tegn til EEPROM\r\n&quot;);
#endif
    //i2c_write_serial(eeprom_addr,0,0);
    i2c_write_serial(eeprom_addr, eeprom_test, 17); //0x00, 0x00, 1, 2, 3, 4, 5, 6, 7, 8, 9, 0x0a, 0x0b, 0x0c, 0x0d, 0x0e, 0x0f
    
#ifdef debug
        printf(&quot;Og laes dem igen\r\n&quot;);
#endif
    i2c_write_serial(eeprom_addr, eeprom_pointer, 2); //0x00, 0x00
    i2c_read_serial(eeprom_addr, eeprom_buffer, 17);
}


void i2c_eeprom_logData(void) {
    // Læs sidste adresse på EEPROM i register 0 og register 1
    i2c_write_serial(eeprom_addr, eeprom_pointer, 2); //0x00, 0x00
    i2c_read_serial(eeprom_addr, eeprom_buffer, 4);

    // Hvis register 0 er 0x0000 og register 1 er 0x0004

    // er det en start på måling
    // eller hvis register 1 er forskellig fra 4 er der sket en fejl
    // Flut adresse til register 1
    // Skriv 0 på register 0
    // Læs fra sensor
    // Skriv data på eeprom
    // Læg ny adresse på register 0
}


void i2c_eeprom_initEeprom(void) {
    // Skriv addresse reg0: 0x0000 reg1:0x0004
    i2c_write_serial(eeprom_addr, eeprom_init, 6); //0x00, 0x00, 0x00, 0x00, 0x00, 0x04
    i2c_write_serial(eeprom_addr, eeprom_pointer, 2); //0x00, 0x00
}


void i2c_eeprom_dumpLogData(void) {
    // Læs adresse i resister 0
    // Hvis adressen er forskellig fra 0x0000
    // eller er der oåtrådt en fejl
    
    // Udlæs data udfra skabelon
    
    uint8_t    i = 0;
    uint32_t   i_max = 0xFFFF;
    uint8_t    j = 0;
    uint8_t    eeprom_buffer[20];
    uint8_t    tmp[130];
    uint8_t    msg[255];
    uint32_t   tmp_moist = 0;
    int32_t    tmp_temp  = 0;
    const char template[] = &quot;&lt;p class=\&quot;log_line\&quot;&gt;&lt;span class=\&quot;temperature_text\&quot;&gt;%2.2f&lt;/span&gt;&lt;span class=\&quot;moisture_text\&quot;&gt;%d%&lt;/span&gt;&lt;/p&gt;\n&quot;;
    
    i2c_eeprom_initEeprom();
    
    // EEPROM holder den interne pointe ved reads. 4 byte * 4 linier * 105 tegn = 1680 tegn
    while ( i &lt;= i_max ) {
        i2c_read_serial(eeprom_addr, eeprom_buffer, 8); // 4 bytes x 2 linier = 8 bytes
        
        // 2 bytes * 6 linier
        j = 0;
        while ( j &lt; 8 ) {

            tmp_moist  = ( eeprom_buffer[j++] &amp; 0b00111111 ) &lt;&lt; 8;
            tmp_moist +=   eeprom_buffer[j++];
            tmp_moist *= 100;
            tmp_moist /= 16382;
            
            // Sensor er gyldig mellem -25 til 85 grader
            tmp_temp  = eeprom_buffer[j++] &lt;&lt; 8;
            tmp_temp += eeprom_buffer[j++];
            tmp_temp &gt;&gt;= 2;
        
            tmp_temp *= 16500;
            tmp_temp /= 16382;
            tmp_temp -= 4000;

            sprintf((char) tmp, template, tmp_moist, tmp_temp ); // Lav linie fra skabelon
            strcat(msg, tmp); // læg den til besked
        }
        
        printf( &quot;AT+CIPSEND=0,%d\r\n&quot;, strlen(msg) ); // Starter sending
        __delay_ms(70);
        printf(msg);
        __delay_ms(70);
    }
    
    i += j;
}


/**************************************************************/
#endif /*EEPROM_C*/



/**************************************************************
                        Realtime clock
 **************************************************************/
#ifndef RTC_C

void i2c_rtc_Read(void) {
    //i2c_write_serial(rtc_addr, &quot;\0&quot;, 1); //0x00, 0x00
    //i2c_read_serial(rtc_addr, rtc_buffer, 16);
    setSeconds(28);
}


void i2c_rtc_Write(uint8_t *rtcAddr, uint8_t value) {}

/*
 * Funktion som returnerer alle data fra real-time clocken, og returnerer en 
 * pointer til de hentede data
 * 
 * Vi er så heldige at real-time har en addresse ponter med autoincremenet,
 * så det er bar at sætte adresse pointer til adresse 0x00 og derefter læse
 * 0x0F bytes. Alle bytes er i BCD format, så de er nemme at konvertere
 */
void rtc_getTimeAll(void) {
    uint8_t rtcData[65];
    // Hent tider og afkod værdier
    i2c_read_serial(rtc_addr, rtcData, 16); // 0x00 til 0x0F
}


void rtc_setTimeAll(uint8_t hours, uint8_t mins, uint8_t secs, uint8_t day, uint8_t date, uint8_t month, int16_t years) {
    bool century = (years&gt;1999 || (years&gt;=0 &amp;&amp; years &lt;=99) )?1:0;
    
    // Sæt rtc adresse til 0x00    
    char rtc_date[] = {
        convertByte2BCD(secs),
        convertByte2BCD(mins),
        convertByte2BCD(hours),
        convertByte2BCD(day),
        convertByte2BCD(date),
        (century)?(convertByte2BCD(month) &amp; 0x80):(convertByte2BCD(month)),
        convertByte2BCD(years)
    };
    
    i2c_write_serial(rtc_addr, rtc_date, 7);
}


uint8_t convertBCD2Bytes(uint8_t bcdByte, char *__HI, char *__LO) {
    uint8_t result;
    //Vi får et BCD tal fra rts kredsen
    uint8_t ciffer1 = 0;
    uint8_t ciffer2 = 0;
    
    // Afmasker de sidste 4 bits
    ciffer1 = bcdByte &amp; 0x11110000;
    
    // Afmasker de første 4 bits
    ciffer2 = bcdByte &amp; 0x00001111;
    
    return result;
}


uint8_t convertByte2BCD(uint8_t byte) {
    uint8_t result = 0;
    
    //Eks. 12
    result  = ( byte / 10 ) &lt;&lt; 4; // Eks. hi = 1, result = 0b0001 0000
    result += byte % 10; // Eks. lo = 2 result = 0b0001 0010    
    return result;
}

uint8_t getSeconds(void) { return false; }
bool setSeconds(uint8_t secs) {
    time.seconds = secs;
    char data = convertByte2BCD(secs);
    //char rtcRegister[] = {time.secondsAddr, data};
    //i2c_write_serial(rtc_addr, rtcRegister, 2);
    return 1;
}

uint8_t getMinutes(void) { return false; }
bool setMinutes(uint8_t mins) {
    char data = convertByte2BCD(mins);
    char rtcRegister[] = {time.minutesAddr, data};
    i2c_write_serial(rtc_addr, rtcRegister, 2);
    return 1;
}

uint8_t getHour(void) { return false; }
bool setHour(uint8_t hours) {
    char data = convertByte2BCD(hours);
    char rtcRegister[] = {time.hoursAddr, data};
    i2c_write_serial(rtc_addr, rtcRegister, 2);
    return 1;
}

uint8_t getAMPM(void) { return false; }
void setAMPM(uint8_t __pm_nam) {
    time.timePMnAM = __pm_nam;
    //uint8_t data = convertByte2BCD(__pm_nam, time.  pm_namHi, time.pm_namLo);
    //uint8_t rtcRegister[] = {time.pm_namAddr, data};
    //i2c_write_serial(rtc_addr, rtcRegister, 2);
    
    //printf(&quot;Minutes BCD: %u - %s%s\r\n&quot;, data, time.pm_namHi, time.pm_namLo);
}

uint8_t getDay(void) { return false; }
void setDay(uint8_t day) {
    char data = convertByte2BCD(day);
    char rtcRegister[] = {time.dayAddr, data};
    i2c_write_serial(rtc_addr, rtcRegister, 2); 
}

uint8_t getMonth(void) { return false; }
void setMonth(uint8_t month) {
    char data = convertByte2BCD(month);
    char rtcRegister[] = {time.monthAddr, data};
    i2c_write_serial(rtc_addr, rtcRegister, 2);
}

uint8_t getYear(void) { return false; }
void setYear(uint8_t years) {
    char data = convertByte2BCD(years);
    time.year=years;
    char rtcRegister[] = {time.yearAddr, data};
    i2c_write_serial(rtc_addr, rtcRegister, 2);
}

// Alarm 1 indstillinger registre 0x07-0x0A
/*void setAlarm1(uint8_t) {}

uint8_t getAlarm1Seconds(void) { return false; }
bool setAlarm1Seconds(uint8_t) {}

uint8_t getAlarm1Minutes(void) { return false; }
bool setAlarm1Minutes(uint8_t) {}

uint8_t getAlarm1Hours(void) { return false; }
bool setAlarm1Hours(uint8_t) {}

uint8_t getAlarm1AMPM(void) { return false; }
bool setAlarm1AMPM(uint8_t) {}
 */

// Alarm 2 indstillinger registre 0x0B-0x0D
/*
void setAlarm2(void) {}

uint8_t getAlarm2Seconds(void) {}
bool setAlarm2Seconds(void) {}

uint8_t getAlarm2Minutes(void) {}
bool setAlarm2Minutes(void) {}

uint8_t getAlarm2Hours(void) {}
bool setAlarm2Hours(void) {}

uint8_t getAlarm2AMPM(void) {}
bool setAlarm2AMPM(void) {}
 */



/**************************************************************/
#endif /*RTC_C*/
</span> </div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    <span class="comment">//tmp_string[length++] = 0xDF; // Eksisterende grad tegn</span></div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    <a class="code" href="i2c_8h.html#a9eec345fbe35bae76df320fc80e492d6">tmp_string</a>[length++] = 0x00;</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    <span class="comment">/*tmp_string[length++] = 0x01;</span></div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;<span class="comment">    tmp_string[length++] = 0x02;</span></div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;<span class="comment">    tmp_string[length++] = 0x03;</span></div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;<span class="comment">    tmp_string[length++] = 0x04;</span></div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;<span class="comment">    tmp_string[length++] = 0x05;</span></div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="comment">    tmp_string[length++] = 0x06;</span></div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;<span class="comment">    tmp_string[length++] = 0x07;*/</span></div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160; </div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    <a class="code" href="i2c_8c.html#a2afd8da70c8c74e56659da3dd6f60dd0">i2c_write_serial</a>(<a class="code" href="i2c_8h.html#a8683f936ecb5cd7b43c33a01a435a7ba">display_addr</a>, <a class="code" href="i2c_8h.html#ac7bc4c6b2054a016f7d53f237f1ebdd6">temp_pos</a>, 2);</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    <a class="code" href="i2c_8c.html#a2afd8da70c8c74e56659da3dd6f60dd0">i2c_write_serial</a>(<a class="code" href="i2c_8h.html#a8683f936ecb5cd7b43c33a01a435a7ba">display_addr</a>, <a class="code" href="i2c_8h.html#a9eec345fbe35bae76df320fc80e492d6">tmp_string</a>, length);</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;}</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160; </div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160; </div>
<div class="line"><a name="l00366"></a><span class="lineno"><a class="line" href="i2c_8h.html#afd26e1603b02dbcbe0b9f2215fec957d">  366</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="i2c_8c.html#afd26e1603b02dbcbe0b9f2215fec957d">updateTemperature</a>(int8_t temp) {</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    <span class="keywordflow">if</span>(temp &lt; 0) {</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;        <a class="code" href="i2c_8c.html#a2afd8da70c8c74e56659da3dd6f60dd0">i2c_write_serial</a>(<a class="code" href="i2c_8h.html#a8683f936ecb5cd7b43c33a01a435a7ba">display_addr</a>, <a class="code" href="i2c_8h.html#ac7bc4c6b2054a016f7d53f237f1ebdd6">temp_pos</a>, 2);</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;        <a class="code" href="i2c_8c.html#a2afd8da70c8c74e56659da3dd6f60dd0">i2c_write_serial</a>(<a class="code" href="i2c_8h.html#a8683f936ecb5cd7b43c33a01a435a7ba">display_addr</a>, <a class="code" href="i2c_8h.html#afd2f05c788bfded35a08a7ff199d5c10">minus</a>, 2);</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;        temp *= -1;</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (temp &gt; 9) {</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;        uint8_t tens = (uint8_t) (temp / 10) | 0b00110000;</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;        uint8_t ones = (uint8_t) (temp % 10) | 0b00110000;        </div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;        <span class="keywordtype">char</span>    output[] = {0x40, tens , ones, 3};</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;        </div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;        <a class="code" href="i2c_8c.html#a2afd8da70c8c74e56659da3dd6f60dd0">i2c_write_serial</a>(<a class="code" href="i2c_8h.html#a8683f936ecb5cd7b43c33a01a435a7ba">display_addr</a>, <a class="code" href="i2c_8h.html#ac7bc4c6b2054a016f7d53f237f1ebdd6">temp_pos</a>, 2);</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;        <a class="code" href="i2c_8c.html#a2afd8da70c8c74e56659da3dd6f60dd0">i2c_write_serial</a>(<a class="code" href="i2c_8h.html#a8683f936ecb5cd7b43c33a01a435a7ba">display_addr</a>, output, 3);</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    }</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;}</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160; </div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160; </div>
<div class="line"><a name="l00382"></a><span class="lineno"><a class="line" href="i2c_8h.html#ad3828dbeeaba956b4a4bee1ed8b3a6e9">  382</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="i2c_8c.html#a801e6fe14e7cf1f1e51e219b8593c8d4">updateMoist</a>(uint8_t moist) {</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    <span class="keywordtype">char</span> output[20];</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    output[0] = 0x40;</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    </div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    <span class="keywordflow">if</span>(moist &gt;= 100) {</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;        output[1] = 1;</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;        output[1] |= 0b00110000;</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;        moist -= 100;</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;        output[1] = 0b10100000;</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    }</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    </div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    <span class="keywordflow">if</span>(moist &gt;= 10) {</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;        output[2] = (moist / 10) | 0b00110000;</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;        output[3] = (moist % 10) | 0b00110000;</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;        output[1] = 0b10100000;</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;        output[2] = 0b10100000;</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;        output[3] = moist | 0b00110000;</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    }</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160; </div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    <a class="code" href="i2c_8c.html#a2afd8da70c8c74e56659da3dd6f60dd0">i2c_write_serial</a>(<a class="code" href="i2c_8h.html#a8683f936ecb5cd7b43c33a01a435a7ba">display_addr</a>, <a class="code" href="i2c_8h.html#af641e3ac716e60485e1748d9e013a15d">moist_pos</a>, 2);</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    <a class="code" href="i2c_8c.html#a2afd8da70c8c74e56659da3dd6f60dd0">i2c_write_serial</a>(<a class="code" href="i2c_8h.html#a8683f936ecb5cd7b43c33a01a435a7ba">display_addr</a>, output, 4);</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;}</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160; </div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160; </div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;<span class="comment">/**************************************************************/</span></div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160; </div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160; </div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160; </div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;<span class="comment">/**************************************************************</span></div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;<span class="comment">                            EEPROM</span></div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;<span class="comment"> **************************************************************/</span></div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;<span class="preprocessor">#ifndef EEPROM_C</span></div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160; </div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160; </div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160; </div>
<div class="line"><a name="l00420"></a><span class="lineno"><a class="line" href="i2c_8h.html#ac26c9d95dfa5cad2f457a88856e94165">  420</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="i2c_8c.html#ac26c9d95dfa5cad2f457a88856e94165">i2c_eeprom_testData</a>(<span class="keywordtype">void</span>) {</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;<span class="preprocessor">#ifdef debug</span></div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    printf(<span class="stringliteral">&quot;Skriv tegn til EEPROM\r\n&quot;</span>);</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    <span class="comment">//i2c_write_serial(eeprom_addr,0,0);</span></div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    <a class="code" href="i2c_8c.html#a2afd8da70c8c74e56659da3dd6f60dd0">i2c_write_serial</a>(<a class="code" href="i2c_8h.html#a40bea318237f8ef4c61e6e4cf8dfcdb1">eeprom_addr</a>, <a class="code" href="i2c_8h.html#a7fef1b6528dcbfcb92dee4a44d0559f3">eeprom_test</a>, 17); <span class="comment">//0x00, 0x00, 1, 2, 3, 4, 5, 6, 7, 8, 9, 0x0a, 0x0b, 0x0c, 0x0d, 0x0e, 0x0f</span></div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    </div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;<span class="preprocessor">#ifdef debug</span></div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;        printf(<span class="stringliteral">&quot;Og laes dem igen\r\n&quot;</span>);</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    <a class="code" href="i2c_8c.html#a2afd8da70c8c74e56659da3dd6f60dd0">i2c_write_serial</a>(<a class="code" href="i2c_8h.html#a40bea318237f8ef4c61e6e4cf8dfcdb1">eeprom_addr</a>, <a class="code" href="i2c_8h.html#a71ae249f4d73448170e448c34e5d7ac4">eeprom_pointer</a>, 2); <span class="comment">//0x00, 0x00</span></div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    <a class="code" href="i2c_8c.html#abeb4d291e6ada6f8ad8cdfde914e92ab">i2c_read_serial</a>(<a class="code" href="i2c_8h.html#a40bea318237f8ef4c61e6e4cf8dfcdb1">eeprom_addr</a>, <a class="code" href="i2c_8h.html#aa51640d985382739c2811f8b69f308ae">eeprom_buffer</a>, 17);</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;}</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160; </div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160; </div>
<div class="line"><a name="l00435"></a><span class="lineno"><a class="line" href="i2c_8h.html#a94acdddf8ba821ce3256b6000798729a">  435</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="i2c_8c.html#a94acdddf8ba821ce3256b6000798729a">i2c_eeprom_logData</a>(<span class="keywordtype">void</span>) {</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    <span class="comment">// Læs sidste adresse på EEPROM i register 0 og register 1</span></div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    <a class="code" href="i2c_8c.html#a2afd8da70c8c74e56659da3dd6f60dd0">i2c_write_serial</a>(<a class="code" href="i2c_8h.html#a40bea318237f8ef4c61e6e4cf8dfcdb1">eeprom_addr</a>, <a class="code" href="i2c_8h.html#a71ae249f4d73448170e448c34e5d7ac4">eeprom_pointer</a>, 2); <span class="comment">//0x00, 0x00</span></div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    <a class="code" href="i2c_8c.html#abeb4d291e6ada6f8ad8cdfde914e92ab">i2c_read_serial</a>(<a class="code" href="i2c_8h.html#a40bea318237f8ef4c61e6e4cf8dfcdb1">eeprom_addr</a>, <a class="code" href="i2c_8h.html#aa51640d985382739c2811f8b69f308ae">eeprom_buffer</a>, 4);</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160; </div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    <span class="comment">// Hvis register 0 er 0x0000 og register 1 er 0x0004</span></div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160; </div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    <span class="comment">// er det en start på måling</span></div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    <span class="comment">// eller hvis register 1 er forskellig fra 4 er der sket en fejl</span></div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    <span class="comment">// Flut adresse til register 1</span></div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    <span class="comment">// Skriv 0 på register 0</span></div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    <span class="comment">// Læs fra sensor</span></div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    <span class="comment">// Skriv data på eeprom</span></div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    <span class="comment">// Læg ny adresse på register 0</span></div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;}</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160; </div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160; </div>
<div class="line"><a name="l00452"></a><span class="lineno"><a class="line" href="i2c_8h.html#a822140c93aab67d6a42a9969beabebcf">  452</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="i2c_8c.html#a822140c93aab67d6a42a9969beabebcf">i2c_eeprom_initEeprom</a>(<span class="keywordtype">void</span>) {</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    <span class="comment">// Skriv addresse reg0: 0x0000 reg1:0x0004</span></div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    <a class="code" href="i2c_8c.html#a2afd8da70c8c74e56659da3dd6f60dd0">i2c_write_serial</a>(<a class="code" href="i2c_8h.html#a40bea318237f8ef4c61e6e4cf8dfcdb1">eeprom_addr</a>, <a class="code" href="i2c_8h.html#ab33acfe5e102c73df9fd842d9a9757ef">eeprom_init</a>, 6); <span class="comment">//0x00, 0x00, 0x00, 0x00, 0x00, 0x04</span></div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    <a class="code" href="i2c_8c.html#a2afd8da70c8c74e56659da3dd6f60dd0">i2c_write_serial</a>(<a class="code" href="i2c_8h.html#a40bea318237f8ef4c61e6e4cf8dfcdb1">eeprom_addr</a>, <a class="code" href="i2c_8h.html#a71ae249f4d73448170e448c34e5d7ac4">eeprom_pointer</a>, 2); <span class="comment">//0x00, 0x00</span></div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;}</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160; </div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160; </div>
<div class="line"><a name="l00459"></a><span class="lineno"><a class="line" href="i2c_8h.html#a765c99cb79df483416ca7323c16df72c">  459</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="i2c_8c.html#a765c99cb79df483416ca7323c16df72c">i2c_eeprom_dumpLogData</a>(<span class="keywordtype">void</span>) {</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    <span class="comment">// Læs adresse i resister 0</span></div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;    <span class="comment">// Hvis adressen er forskellig fra 0x0000</span></div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;    <span class="comment">// eller er der oåtrådt en fejl</span></div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    </div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;    <span class="comment">// Udlæs data udfra skabelon</span></div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    </div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    uint8_t    i = 0;</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;    uint32_t   i_max = 0xFFFF;</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    uint8_t    j = 0;</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    uint8_t    <a class="code" href="i2c_8h.html#aa51640d985382739c2811f8b69f308ae">eeprom_buffer</a>[20];</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    uint8_t    tmp[130];</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    uint8_t    msg[255];</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    uint32_t   tmp_moist = 0;</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    int32_t    tmp_temp  = 0;</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> <span class="keyword">template</span>[] = <span class="stringliteral">&quot;&lt;p class=\&quot;log_line\&quot;&gt;&lt;span class=\&quot;temperature_text\&quot;&gt;%2.2f&lt;/span&gt;&lt;span class=\&quot;moisture_text\&quot;&gt;%d%&lt;/span&gt;&lt;/p&gt;\n&quot;</span>;</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    </div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    <a class="code" href="i2c_8c.html#a822140c93aab67d6a42a9969beabebcf">i2c_eeprom_initEeprom</a>();</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    </div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    <span class="comment">// EEPROM holder den interne pointe ved reads. 4 byte * 4 linier * 105 tegn = 1680 tegn</span></div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    <span class="keywordflow">while</span> ( i &lt;= i_max ) {</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;        <a class="code" href="i2c_8c.html#abeb4d291e6ada6f8ad8cdfde914e92ab">i2c_read_serial</a>(<a class="code" href="i2c_8h.html#a40bea318237f8ef4c61e6e4cf8dfcdb1">eeprom_addr</a>, <a class="code" href="i2c_8h.html#aa51640d985382739c2811f8b69f308ae">eeprom_buffer</a>, 8); <span class="comment">// 4 bytes x 2 linier = 8 bytes</span></div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;        </div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;        <span class="comment">// 2 bytes * 6 linier</span></div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;        j = 0;</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;        <span class="keywordflow">while</span> ( j &lt; 8 ) {</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160; </div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;            tmp_moist  = ( <a class="code" href="i2c_8h.html#aa51640d985382739c2811f8b69f308ae">eeprom_buffer</a>[j++] &amp; 0b00111111 ) &lt;&lt; 8;</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;            tmp_moist +=   <a class="code" href="i2c_8h.html#aa51640d985382739c2811f8b69f308ae">eeprom_buffer</a>[j++];</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;            tmp_moist *= 100;</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;            tmp_moist /= 16382;</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;            </div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;            <span class="comment">// Sensor er gyldig mellem -25 til 85 grader</span></div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;            tmp_temp  = <a class="code" href="i2c_8h.html#aa51640d985382739c2811f8b69f308ae">eeprom_buffer</a>[j++] &lt;&lt; 8;</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;            tmp_temp += <a class="code" href="i2c_8h.html#aa51640d985382739c2811f8b69f308ae">eeprom_buffer</a>[j++];</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;            tmp_temp &gt;&gt;= 2;</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;        </div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;            tmp_temp *= 16500;</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;            tmp_temp /= 16382;</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;            tmp_temp -= 4000;</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160; </div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;            sprintf((<span class="keywordtype">char</span>) tmp, <span class="keyword">template</span>, tmp_moist, tmp_temp ); <span class="comment">// Lav linie fra skabelon</span></div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;            strcat(msg, tmp); <span class="comment">// læg den til besked</span></div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;        }</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;        </div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;        printf( <span class="stringliteral">&quot;AT+CIPSEND=0,%d\r\n&quot;</span>, strlen(msg) ); <span class="comment">// Starter sending</span></div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;        __delay_ms(70);</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;        printf(msg);</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;        __delay_ms(70);</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    }</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    </div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;    i += j;</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;}</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160; </div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160; </div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;<span class="comment">/**************************************************************/</span></div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/*EEPROM_C*/</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160; </div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160; </div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160; </div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;<span class="comment">/**************************************************************</span></div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;<span class="comment">                        Realtime clock</span></div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;<span class="comment"> **************************************************************/</span></div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;<span class="preprocessor">#ifndef RTC_C</span></div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160; </div>
<div class="line"><a name="l00524"></a><span class="lineno"><a class="line" href="rtc_8h.html#a2db8a01731e16527ae4adecb5c7138a3">  524</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="i2c_8c.html#a2db8a01731e16527ae4adecb5c7138a3">i2c_rtc_Read</a>(<span class="keywordtype">void</span>) {</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;    <span class="comment">//i2c_write_serial(rtc_addr, &quot;\0&quot;, 1); //0x00, 0x00</span></div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;    <span class="comment">//i2c_read_serial(rtc_addr, rtc_buffer, 16);</span></div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;    <a class="code" href="i2c_8c.html#a24e34549cc02b38d5e23ecc25bde880e">setSeconds</a>(28);</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;}</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160; </div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160; </div>
<div class="line"><a name="l00531"></a><span class="lineno"><a class="line" href="rtc_8h.html#a573f0a135e5db8b77d393b48976a8c97">  531</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="i2c_8c.html#a64401883d716efd5212146992862e7e8">i2c_rtc_Write</a>(uint8_t *rtcAddr, uint8_t value) {}</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160; </div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;<span class="comment"> * Funktion som returnerer alle data fra real-time clocken, og returnerer en </span></div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;<span class="comment"> * pointer til de hentede data</span></div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;<span class="comment"> * </span></div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;<span class="comment"> * Vi er så heldige at real-time har en addresse ponter med autoincremenet,</span></div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;<span class="comment"> * så det er bar at sætte adresse pointer til adresse 0x00 og derefter læse</span></div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;<span class="comment"> * 0x0F bytes. Alle bytes er i BCD format, så de er nemme at konvertere</span></div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00541"></a><span class="lineno"><a class="line" href="rtc_8h.html#ab1f61939509af43c803795ad5a76925c">  541</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="i2c_8c.html#ab1f61939509af43c803795ad5a76925c">rtc_getTimeAll</a>(<span class="keywordtype">void</span>) {</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;    uint8_t rtcData[65];</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;    <span class="comment">// Hent tider og afkod værdier</span></div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;    <a class="code" href="i2c_8c.html#abeb4d291e6ada6f8ad8cdfde914e92ab">i2c_read_serial</a>(<a class="code" href="rtc_8h.html#aaddfe18588c54fa64170fce51feed094">rtc_addr</a>, rtcData, 16); <span class="comment">// 0x00 til 0x0F</span></div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;}</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160; </div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160; </div>
<div class="line"><a name="l00548"></a><span class="lineno"><a class="line" href="rtc_8h.html#a97d937a99aecc50685698ab064b4d783">  548</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="i2c_8c.html#af46ed6c3913c335f228d88228591cbb7">rtc_setTimeAll</a>(uint8_t hours, uint8_t mins, uint8_t secs, uint8_t day, uint8_t date, uint8_t month, int16_t years) {</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;    <span class="keywordtype">bool</span> century = (years&gt;1999 || (years&gt;=0 &amp;&amp; years &lt;=99) )?1:0;</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;    </div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;    <span class="comment">// Sæt rtc adresse til 0x00    </span></div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    <span class="keywordtype">char</span> rtc_date[] = {</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;        <a class="code" href="i2c_8c.html#a44cb094ffb7aa06d88a71146c86dede0">convertByte2BCD</a>(secs),</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;        <a class="code" href="i2c_8c.html#a44cb094ffb7aa06d88a71146c86dede0">convertByte2BCD</a>(mins),</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;        <a class="code" href="i2c_8c.html#a44cb094ffb7aa06d88a71146c86dede0">convertByte2BCD</a>(hours),</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;        <a class="code" href="i2c_8c.html#a44cb094ffb7aa06d88a71146c86dede0">convertByte2BCD</a>(day),</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;        <a class="code" href="i2c_8c.html#a44cb094ffb7aa06d88a71146c86dede0">convertByte2BCD</a>(date),</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;        (century)?(<a class="code" href="i2c_8c.html#a44cb094ffb7aa06d88a71146c86dede0">convertByte2BCD</a>(month) &amp; 0x80):(<a class="code" href="i2c_8c.html#a44cb094ffb7aa06d88a71146c86dede0">convertByte2BCD</a>(month)),</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;        <a class="code" href="i2c_8c.html#a44cb094ffb7aa06d88a71146c86dede0">convertByte2BCD</a>(years)</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;    };</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;    </div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;    <a class="code" href="i2c_8c.html#a2afd8da70c8c74e56659da3dd6f60dd0">i2c_write_serial</a>(<a class="code" href="rtc_8h.html#aaddfe18588c54fa64170fce51feed094">rtc_addr</a>, rtc_date, 7);</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;}</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160; </div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160; </div>
<div class="line"><a name="l00566"></a><span class="lineno"><a class="line" href="rtc_8h.html#a9f9a0e5e98743b10b5c1c4da2cfaedab">  566</a></span>&#160;uint8_t <a class="code" href="i2c_8c.html#a12d7ae97b619468f26a6cd1dc2ded7f4">convertBCD2Bytes</a>(uint8_t bcdByte, <span class="keywordtype">char</span> *__HI, <span class="keywordtype">char</span> *__LO) {</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;    uint8_t result;</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;    <span class="comment">//Vi får et BCD tal fra rts kredsen</span></div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;    uint8_t ciffer1 = 0;</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;    uint8_t ciffer2 = 0;</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    </div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;    <span class="comment">// Afmasker de sidste 4 bits</span></div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    ciffer1 = bcdByte &amp; 0x11110000;</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;    </div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;    <span class="comment">// Afmasker de første 4 bits</span></div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;    ciffer2 = bcdByte &amp; 0x00001111;</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;    </div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;}</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160; </div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160; </div>
<div class="line"><a name="l00582"></a><span class="lineno"><a class="line" href="rtc_8h.html#ad0735297387073980996314a5ce03c1a">  582</a></span>&#160;uint8_t <a class="code" href="i2c_8c.html#a44cb094ffb7aa06d88a71146c86dede0">convertByte2BCD</a>(uint8_t <span class="keywordtype">byte</span>) {</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;    uint8_t result = 0;</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;    </div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;    <span class="comment">//Eks. 12</span></div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;    result  = ( <span class="keywordtype">byte</span> / 10 ) &lt;&lt; 4; <span class="comment">// Eks. hi = 1, result = 0b0001 0000</span></div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    result += <span class="keywordtype">byte</span> % 10; <span class="comment">// Eks. lo = 2 result = 0b0001 0010    </span></div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;}</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160; </div>
<div class="line"><a name="l00591"></a><span class="lineno"><a class="line" href="rtc_8h.html#a427111856511ff3f394b035dbb151600">  591</a></span>&#160;uint8_t <a class="code" href="i2c_8c.html#a427111856511ff3f394b035dbb151600">getSeconds</a>(<span class="keywordtype">void</span>) { <span class="keywordflow">return</span> <span class="keyword">false</span>; }</div>
<div class="line"><a name="l00592"></a><span class="lineno"><a class="line" href="rtc_8h.html#a3ea9322599132fae082c5982d764e9fa">  592</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="i2c_8c.html#a24e34549cc02b38d5e23ecc25bde880e">setSeconds</a>(uint8_t secs) {</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;    <a class="code" href="rtc_8h.html#ab842bdb7d02be824fb48613032b4ff36">time</a>.<a class="code" href="struct_t_i_m_e.html#acf81a9eff2e50cb602150a23febb266d">seconds</a> = secs;</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;    <span class="keywordtype">char</span> data = <a class="code" href="i2c_8c.html#a44cb094ffb7aa06d88a71146c86dede0">convertByte2BCD</a>(secs);</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;    <span class="comment">//char rtcRegister[] = {time.secondsAddr, data};</span></div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;    <span class="comment">//i2c_write_serial(rtc_addr, rtcRegister, 2);</span></div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;}</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160; </div>
<div class="line"><a name="l00600"></a><span class="lineno"><a class="line" href="rtc_8h.html#ae66fdb4fe48ccaf1db63bbc1b3fb2c03">  600</a></span>&#160;uint8_t <a class="code" href="i2c_8c.html#ae66fdb4fe48ccaf1db63bbc1b3fb2c03">getMinutes</a>(<span class="keywordtype">void</span>) { <span class="keywordflow">return</span> <span class="keyword">false</span>; }</div>
<div class="line"><a name="l00601"></a><span class="lineno"><a class="line" href="rtc_8h.html#aa9abc281e94788922ebeb320a0966595">  601</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="i2c_8c.html#a923e39b109c4f7162c15970d77028908">setMinutes</a>(uint8_t mins) {</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;    <span class="keywordtype">char</span> data = <a class="code" href="i2c_8c.html#a44cb094ffb7aa06d88a71146c86dede0">convertByte2BCD</a>(mins);</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;    <span class="keywordtype">char</span> rtcRegister[] = {<a class="code" href="rtc_8h.html#ab842bdb7d02be824fb48613032b4ff36">time</a>.<a class="code" href="struct_t_i_m_e.html#a030c668a2df873e113bc6ea5526f28fd">minutesAddr</a>, data};</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;    <a class="code" href="i2c_8c.html#a2afd8da70c8c74e56659da3dd6f60dd0">i2c_write_serial</a>(<a class="code" href="rtc_8h.html#aaddfe18588c54fa64170fce51feed094">rtc_addr</a>, rtcRegister, 2);</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;}</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160; </div>
<div class="line"><a name="l00608"></a><span class="lineno"><a class="line" href="rtc_8h.html#aa3a26eff1590ec982188643bf07bb35b">  608</a></span>&#160;uint8_t <a class="code" href="i2c_8c.html#aa3a26eff1590ec982188643bf07bb35b">getHour</a>(<span class="keywordtype">void</span>) { <span class="keywordflow">return</span> <span class="keyword">false</span>; }</div>
<div class="line"><a name="l00609"></a><span class="lineno"><a class="line" href="rtc_8h.html#ac2177475f109940c57aa90adca259631">  609</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="i2c_8c.html#a9dd37f83ee001921ea5fb8e321c64e86">setHour</a>(uint8_t hours) {</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;    <span class="keywordtype">char</span> data = <a class="code" href="i2c_8c.html#a44cb094ffb7aa06d88a71146c86dede0">convertByte2BCD</a>(hours);</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;    <span class="keywordtype">char</span> rtcRegister[] = {<a class="code" href="rtc_8h.html#ab842bdb7d02be824fb48613032b4ff36">time</a>.<a class="code" href="struct_t_i_m_e.html#a5e5877cb38d93e572f5df856520d3ff4">hoursAddr</a>, data};</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;    <a class="code" href="i2c_8c.html#a2afd8da70c8c74e56659da3dd6f60dd0">i2c_write_serial</a>(<a class="code" href="rtc_8h.html#aaddfe18588c54fa64170fce51feed094">rtc_addr</a>, rtcRegister, 2);</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;    <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;}</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160; </div>
<div class="line"><a name="l00616"></a><span class="lineno"><a class="line" href="rtc_8h.html#ac04c5f5412a1b26bf1563d0cef269683">  616</a></span>&#160;uint8_t <a class="code" href="i2c_8c.html#ac04c5f5412a1b26bf1563d0cef269683">getAMPM</a>(<span class="keywordtype">void</span>) { <span class="keywordflow">return</span> <span class="keyword">false</span>; }</div>
<div class="line"><a name="l00617"></a><span class="lineno"><a class="line" href="rtc_8h.html#a0d02e293f7ac24cb057913471bd5ed01">  617</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="i2c_8c.html#abe294664f7a7f8c8504d3c091823decf">setAMPM</a>(uint8_t __pm_nam) {</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;    <a class="code" href="rtc_8h.html#ab842bdb7d02be824fb48613032b4ff36">time</a>.<a class="code" href="struct_t_i_m_e.html#a638f9e3ed4d0e4d5faac011cdf72aa31">timePMnAM</a> = __pm_nam;</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;    <span class="comment">//uint8_t data = convertByte2BCD(__pm_nam, time.  pm_namHi, time.pm_namLo);</span></div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;    <span class="comment">//uint8_t rtcRegister[] = {time.pm_namAddr, data};</span></div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;    <span class="comment">//i2c_write_serial(rtc_addr, rtcRegister, 2);</span></div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;    </div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;    <span class="comment">//printf(&quot;Minutes BCD: %u - %s%s\r\n&quot;, data, time.pm_namHi, time.pm_namLo);</span></div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;}</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160; </div>
<div class="line"><a name="l00626"></a><span class="lineno"><a class="line" href="rtc_8h.html#a6de2e3a4ee83d93f3743862e16dcf6d3">  626</a></span>&#160;uint8_t <a class="code" href="i2c_8c.html#a6de2e3a4ee83d93f3743862e16dcf6d3">getDay</a>(<span class="keywordtype">void</span>) { <span class="keywordflow">return</span> <span class="keyword">false</span>; }</div>
<div class="line"><a name="l00627"></a><span class="lineno"><a class="line" href="rtc_8h.html#a18c0d5b1938ad598d9d9bb4913022ba4">  627</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="i2c_8c.html#aa9e8b7dcd8d6aa73ea63411e6914073e">setDay</a>(uint8_t day) {</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;    <span class="keywordtype">char</span> data = <a class="code" href="i2c_8c.html#a44cb094ffb7aa06d88a71146c86dede0">convertByte2BCD</a>(day);</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;    <span class="keywordtype">char</span> rtcRegister[] = {<a class="code" href="rtc_8h.html#ab842bdb7d02be824fb48613032b4ff36">time</a>.<a class="code" href="struct_t_i_m_e.html#a26e31c6377ccbc614c348a5a32a7972b">dayAddr</a>, data};</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;    <a class="code" href="i2c_8c.html#a2afd8da70c8c74e56659da3dd6f60dd0">i2c_write_serial</a>(<a class="code" href="rtc_8h.html#aaddfe18588c54fa64170fce51feed094">rtc_addr</a>, rtcRegister, 2); </div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;}</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160; </div>
<div class="line"><a name="l00633"></a><span class="lineno"><a class="line" href="rtc_8h.html#a9953dcbaf8240f4a884194fce6346fed">  633</a></span>&#160;uint8_t <a class="code" href="i2c_8c.html#a9953dcbaf8240f4a884194fce6346fed">getMonth</a>(<span class="keywordtype">void</span>) { <span class="keywordflow">return</span> <span class="keyword">false</span>; }</div>
<div class="line"><a name="l00634"></a><span class="lineno"><a class="line" href="rtc_8h.html#a624df4250aafb7b822a2cc97c1ddab0a">  634</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="i2c_8c.html#ad6a1e92a896b2d26e648625ce6b3861e">setMonth</a>(uint8_t month) {</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;    <span class="keywordtype">char</span> data = <a class="code" href="i2c_8c.html#a44cb094ffb7aa06d88a71146c86dede0">convertByte2BCD</a>(month);</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;    <span class="keywordtype">char</span> rtcRegister[] = {<a class="code" href="rtc_8h.html#ab842bdb7d02be824fb48613032b4ff36">time</a>.<a class="code" href="struct_t_i_m_e.html#a3d46170e1ae99df5b669f7836f84b461">monthAddr</a>, data};</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;    <a class="code" href="i2c_8c.html#a2afd8da70c8c74e56659da3dd6f60dd0">i2c_write_serial</a>(<a class="code" href="rtc_8h.html#aaddfe18588c54fa64170fce51feed094">rtc_addr</a>, rtcRegister, 2);</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;}</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160; </div>
<div class="line"><a name="l00640"></a><span class="lineno"><a class="line" href="rtc_8h.html#a609adf668362d1f0bdd72867125d60dc">  640</a></span>&#160;uint8_t <a class="code" href="i2c_8c.html#a609adf668362d1f0bdd72867125d60dc">getYear</a>(<span class="keywordtype">void</span>) { <span class="keywordflow">return</span> <span class="keyword">false</span>; }</div>
<div class="line"><a name="l00641"></a><span class="lineno"><a class="line" href="rtc_8h.html#adf3bbde32d6ca6c53713822786cf431c">  641</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="i2c_8c.html#a8a67e34b654397f7e419889fe802dbff">setYear</a>(uint8_t years) {</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;    <span class="keywordtype">char</span> data = <a class="code" href="i2c_8c.html#a44cb094ffb7aa06d88a71146c86dede0">convertByte2BCD</a>(years);</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;    <a class="code" href="rtc_8h.html#ab842bdb7d02be824fb48613032b4ff36">time</a>.<a class="code" href="struct_t_i_m_e.html#aa57c3e33a674d9e17375bfa15b89989f">year</a>=years;</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;    <span class="keywordtype">char</span> rtcRegister[] = {<a class="code" href="rtc_8h.html#ab842bdb7d02be824fb48613032b4ff36">time</a>.<a class="code" href="struct_t_i_m_e.html#aaf16f1a35a80295ebba855ac071a9526">yearAddr</a>, data};</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;    <a class="code" href="i2c_8c.html#a2afd8da70c8c74e56659da3dd6f60dd0">i2c_write_serial</a>(<a class="code" href="rtc_8h.html#aaddfe18588c54fa64170fce51feed094">rtc_addr</a>, rtcRegister, 2);</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;}</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160; </div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;<span class="comment">// Alarm 1 indstillinger registre 0x07-0x0A</span></div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;<span class="comment">/*void setAlarm1(uint8_t) {}</span></div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;<span class="comment">uint8_t getAlarm1Seconds(void) { return false; }</span></div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;<span class="comment">bool setAlarm1Seconds(uint8_t) {}</span></div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;<span class="comment">uint8_t getAlarm1Minutes(void) { return false; }</span></div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;<span class="comment">bool setAlarm1Minutes(uint8_t) {}</span></div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;<span class="comment">uint8_t getAlarm1Hours(void) { return false; }</span></div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;<span class="comment">bool setAlarm1Hours(uint8_t) {}</span></div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;<span class="comment">uint8_t getAlarm1AMPM(void) { return false; }</span></div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;<span class="comment">bool setAlarm1AMPM(uint8_t) {}</span></div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160; </div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;<span class="comment">// Alarm 2 indstillinger registre 0x0B-0x0D</span></div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;<span class="comment">void setAlarm2(void) {}</span></div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;<span class="comment">uint8_t getAlarm2Seconds(void) {}</span></div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;<span class="comment">bool setAlarm2Seconds(void) {}</span></div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;<span class="comment">uint8_t getAlarm2Minutes(void) {}</span></div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;<span class="comment">bool setAlarm2Minutes(void) {}</span></div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;<span class="comment">uint8_t getAlarm2Hours(void) {}</span></div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;<span class="comment">bool setAlarm2Hours(void) {}</span></div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;<span class="comment">uint8_t getAlarm2AMPM(void) {}</span></div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;<span class="comment">bool setAlarm2AMPM(void) {}</span></div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160; </div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160; </div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160; </div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;<span class="comment">/**************************************************************/</span></div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/*RTC_C*/</span><span class="preprocessor"></span></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<div class="ttc" id="ai2c_8h_html_a8eac694cd48788e914ae973b41d1b8ec"><div class="ttname"><a href="i2c_8h.html#a8eac694cd48788e914ae973b41d1b8ec">data_out</a></div><div class="ttdeci">uint8_t data_out[4]</div><div class="ttdef"><b>Definition:</b> <a href="i2c_8h_source.html#l00041">i2c.h:41</a></div></div>
<div class="ttc" id="ai2c_8c_html_a2db8a01731e16527ae4adecb5c7138a3"><div class="ttname"><a href="i2c_8c.html#a2db8a01731e16527ae4adecb5c7138a3">i2c_rtc_Read</a></div><div class="ttdeci">void i2c_rtc_Read(void)</div><div class="ttdef"><b>Definition:</b> <a href="i2c_8c_source.html#l00524">i2c.c:524</a></div></div>
<div class="ttc" id="ai2c_8c_html_a923e39b109c4f7162c15970d77028908"><div class="ttname"><a href="i2c_8c.html#a923e39b109c4f7162c15970d77028908">setMinutes</a></div><div class="ttdeci">bool setMinutes(uint8_t mins)</div><div class="ttdef"><b>Definition:</b> <a href="i2c_8c_source.html#l00601">i2c.c:601</a></div></div>
<div class="ttc" id="ai2c_8c_html_a94acdddf8ba821ce3256b6000798729a"><div class="ttname"><a href="i2c_8c.html#a94acdddf8ba821ce3256b6000798729a">i2c_eeprom_logData</a></div><div class="ttdeci">void i2c_eeprom_logData(void)</div><div class="ttdef"><b>Definition:</b> <a href="i2c_8c_source.html#l00435">i2c.c:435</a></div></div>
<div class="ttc" id="ai2c_8h_html_a71ae249f4d73448170e448c34e5d7ac4"><div class="ttname"><a href="i2c_8h.html#a71ae249f4d73448170e448c34e5d7ac4">eeprom_pointer</a></div><div class="ttdeci">const char eeprom_pointer[]</div><div class="ttdef"><b>Definition:</b> <a href="i2c_8h_source.html#l00105">i2c.h:105</a></div></div>
<div class="ttc" id="ai2c_8c_html_a6caad88441987f83268d336d4322d07d"><div class="ttname"><a href="i2c_8c.html#a6caad88441987f83268d336d4322d07d">i2c_master_ack</a></div><div class="ttdeci">void i2c_master_ack(void)</div><div class="ttdef"><b>Definition:</b> <a href="i2c_8c_source.html#l00219">i2c.c:219</a></div></div>
<div class="ttc" id="ai2c_8h_html_af641e3ac716e60485e1748d9e013a15d"><div class="ttname"><a href="i2c_8h.html#af641e3ac716e60485e1748d9e013a15d">moist_pos</a></div><div class="ttdeci">const char moist_pos[]</div><div class="ttdef"><b>Definition:</b> <a href="i2c_8h_source.html#l00085">i2c.h:85</a></div></div>
<div class="ttc" id="ai2c_8h_html_abd4afcc16efaddacd3e1078677f09aea"><div class="ttname"><a href="i2c_8h.html#abd4afcc16efaddacd3e1078677f09aea">temperature_addr</a></div><div class="ttdeci">const uint8_t temperature_addr</div><div class="ttdef"><b>Definition:</b> <a href="i2c_8h_source.html#l00079">i2c.h:79</a></div></div>
<div class="ttc" id="artc_8h_html_ab842bdb7d02be824fb48613032b4ff36"><div class="ttname"><a href="rtc_8h.html#ab842bdb7d02be824fb48613032b4ff36">time</a></div><div class="ttdeci">time_t time</div><div class="ttdef"><b>Definition:</b> <a href="rtc_8h_source.html#l00108">rtc.h:108</a></div></div>
<div class="ttc" id="ai2c_8c_html_a24e34549cc02b38d5e23ecc25bde880e"><div class="ttname"><a href="i2c_8c.html#a24e34549cc02b38d5e23ecc25bde880e">setSeconds</a></div><div class="ttdeci">bool setSeconds(uint8_t secs)</div><div class="ttdef"><b>Definition:</b> <a href="i2c_8c_source.html#l00592">i2c.c:592</a></div></div>
<div class="ttc" id="atcpip_8h_html"><div class="ttname"><a href="tcpip_8h.html">tcpip.h</a></div></div>
<div class="ttc" id="ai2c_8h_html_a2190e3cca1f36422ffbff3de09bccbec"><div class="ttname"><a href="i2c_8h.html#a2190e3cca1f36422ffbff3de09bccbec">first_line</a></div><div class="ttdeci">const char first_line[]</div><div class="ttdef"><b>Definition:</b> <a href="i2c_8h_source.html#l00065">i2c.h:65</a></div></div>
<div class="ttc" id="aesp8266_8h_html_a4952c1b7f3ed488d08e34f466ba70db8"><div class="ttname"><a href="esp8266_8h.html#a4952c1b7f3ed488d08e34f466ba70db8">states</a></div><div class="ttdeci">states_t states</div><div class="ttdef"><b>Definition:</b> <a href="esp8266_8h_source.html#l00078">esp8266.h:78</a></div></div>
<div class="ttc" id="ai2c_8c_html_abe294664f7a7f8c8504d3c091823decf"><div class="ttname"><a href="i2c_8c.html#abe294664f7a7f8c8504d3c091823decf">setAMPM</a></div><div class="ttdeci">void setAMPM(uint8_t __pm_nam)</div><div class="ttdef"><b>Definition:</b> <a href="i2c_8c_source.html#l00617">i2c.c:617</a></div></div>
<div class="ttc" id="ai2c_8h_html_a40bea318237f8ef4c61e6e4cf8dfcdb1"><div class="ttname"><a href="i2c_8h.html#a40bea318237f8ef4c61e6e4cf8dfcdb1">eeprom_addr</a></div><div class="ttdeci">const uint8_t eeprom_addr</div><div class="ttdef"><b>Definition:</b> <a href="i2c_8h_source.html#l00102">i2c.h:102</a></div></div>
<div class="ttc" id="ai2c_8c_html_a609adf668362d1f0bdd72867125d60dc"><div class="ttname"><a href="i2c_8c.html#a609adf668362d1f0bdd72867125d60dc">getYear</a></div><div class="ttdeci">uint8_t getYear(void)</div><div class="ttdef"><b>Definition:</b> <a href="i2c_8c_source.html#l00640">i2c.c:640</a></div></div>
<div class="ttc" id="ai2c_8c_html_a2bb899e439501717070e41d0daf659c6"><div class="ttname"><a href="i2c_8c.html#a2bb899e439501717070e41d0daf659c6">i2c_lcd_write</a></div><div class="ttdeci">void i2c_lcd_write(char *tmpmsg, uint8_t line, uint8_t pos)</div><div class="ttdef"><b>Definition:</b> <a href="i2c_8c_source.html#l00259">i2c.c:259</a></div></div>
<div class="ttc" id="ai2c_8c_html_abeb4d291e6ada6f8ad8cdfde914e92ab"><div class="ttname"><a href="i2c_8c.html#abeb4d291e6ada6f8ad8cdfde914e92ab">i2c_read_serial</a></div><div class="ttdeci">void i2c_read_serial(uint8_t addr, uint8_t *data_out, uint8_t length)</div><div class="ttdef"><b>Definition:</b> <a href="i2c_8c_source.html#l00135">i2c.c:135</a></div></div>
<div class="ttc" id="ai2c_8c_html_ab98870ccbc4924e9224e1efa8de12409"><div class="ttname"><a href="i2c_8c.html#ab98870ccbc4924e9224e1efa8de12409">i2c_temp_testTempSensor</a></div><div class="ttdeci">void i2c_temp_testTempSensor(void)</div><div class="ttdef"><b>Definition:</b> <a href="i2c_8c_source.html#l00280">i2c.c:280</a></div></div>
<div class="ttc" id="aesp8266_8c_html_aa5e1cb340835d3ac9cb4c407ca03c1a2"><div class="ttname"><a href="esp8266_8c.html#aa5e1cb340835d3ac9cb4c407ca03c1a2">esp_terminalTransmit</a></div><div class="ttdeci">void esp_terminalTransmit(char *sendmsg)</div><div class="ttdef"><b>Definition:</b> <a href="esp8266_8c_source.html#l00465">esp8266.c:465</a></div></div>
<div class="ttc" id="ai2c_8c_html_a9953dcbaf8240f4a884194fce6346fed"><div class="ttname"><a href="i2c_8c.html#a9953dcbaf8240f4a884194fce6346fed">getMonth</a></div><div class="ttdeci">uint8_t getMonth(void)</div><div class="ttdef"><b>Definition:</b> <a href="i2c_8c_source.html#l00633">i2c.c:633</a></div></div>
<div class="ttc" id="astruct_states_html_a15c190cd300d7947b7cdc7fd677d7a52"><div class="ttname"><a href="struct_states.html#a15c190cd300d7947b7cdc7fd677d7a52">States::error</a></div><div class="ttdeci">bool error</div><div class="ttdef"><b>Definition:</b> <a href="esp8266_8h_source.html#l00071">esp8266.h:71</a></div></div>
<div class="ttc" id="astruct_t_i_m_e_html_a26e31c6377ccbc614c348a5a32a7972b"><div class="ttname"><a href="struct_t_i_m_e.html#a26e31c6377ccbc614c348a5a32a7972b">TIME::dayAddr</a></div><div class="ttdeci">uint8_t dayAddr</div><div class="ttdef"><b>Definition:</b> <a href="rtc_8h_source.html#l00051">rtc.h:51</a></div></div>
<div class="ttc" id="ai2c_8c_html_a47c73631070ab0c6b9e7574163b90d87"><div class="ttname"><a href="i2c_8c.html#a47c73631070ab0c6b9e7574163b90d87">empty_line</a></div><div class="ttdeci">const char empty_line[]</div><div class="ttdef"><b>Definition:</b> <a href="i2c_8c_source.html#l00244">i2c.c:244</a></div></div>
<div class="ttc" id="ai2c_8c_html_a9dd37f83ee001921ea5fb8e321c64e86"><div class="ttname"><a href="i2c_8c.html#a9dd37f83ee001921ea5fb8e321c64e86">setHour</a></div><div class="ttdeci">bool setHour(uint8_t hours)</div><div class="ttdef"><b>Definition:</b> <a href="i2c_8c_source.html#l00609">i2c.c:609</a></div></div>
<div class="ttc" id="astruct_t_i_m_e_html_aa57c3e33a674d9e17375bfa15b89989f"><div class="ttname"><a href="struct_t_i_m_e.html#aa57c3e33a674d9e17375bfa15b89989f">TIME::year</a></div><div class="ttdeci">uint8_t year</div><div class="ttdef"><b>Definition:</b> <a href="rtc_8h_source.html#l00058">rtc.h:58</a></div></div>
<div class="ttc" id="ai2c_8h_html_aac625d7a605ca9aca6a1775119fc307d"><div class="ttname"><a href="i2c_8h.html#aac625d7a605ca9aca6a1775119fc307d">display_init</a></div><div class="ttdeci">const char display_init[]</div><div class="ttdef"><b>Definition:</b> <a href="i2c_8h_source.html#l00063">i2c.h:63</a></div></div>
<div class="ttc" id="astruct_t_i_m_e_html_a3d46170e1ae99df5b669f7836f84b461"><div class="ttname"><a href="struct_t_i_m_e.html#a3d46170e1ae99df5b669f7836f84b461">TIME::monthAddr</a></div><div class="ttdeci">uint8_t monthAddr</div><div class="ttdef"><b>Definition:</b> <a href="rtc_8h_source.html#l00055">rtc.h:55</a></div></div>
<div class="ttc" id="ai2c_8c_html_a1b96df492284070c5fb8ac5daa5a53a1"><div class="ttname"><a href="i2c_8c.html#a1b96df492284070c5fb8ac5daa5a53a1">i2c_portScan</a></div><div class="ttdeci">void i2c_portScan(void)</div><div class="ttdef"><b>Definition:</b> <a href="i2c_8c_source.html#l00056">i2c.c:56</a></div></div>
<div class="ttc" id="ai2c_8c_html_a02d93c2bcdbbee7a791b77b0cf12467f"><div class="ttname"><a href="i2c_8c.html#a02d93c2bcdbbee7a791b77b0cf12467f">i2c_master_start</a></div><div class="ttdeci">void i2c_master_start(void)</div><div class="ttdef"><b>Definition:</b> <a href="i2c_8c_source.html#l00199">i2c.c:199</a></div></div>
<div class="ttc" id="ai2c_8c_html_adb646b67ce754741a06e63ea28d05259"><div class="ttname"><a href="i2c_8c.html#adb646b67ce754741a06e63ea28d05259">i2c_master_wait</a></div><div class="ttdeci">void i2c_master_wait(void)</div><div class="ttdef"><b>Definition:</b> <a href="i2c_8c_source.html#l00190">i2c.c:190</a></div></div>
<div class="ttc" id="ai2c_8c_html_afd26e1603b02dbcbe0b9f2215fec957d"><div class="ttname"><a href="i2c_8c.html#afd26e1603b02dbcbe0b9f2215fec957d">updateTemperature</a></div><div class="ttdeci">void updateTemperature(int8_t temp)</div><div class="ttdef"><b>Definition:</b> <a href="i2c_8c_source.html#l00366">i2c.c:366</a></div></div>
<div class="ttc" id="ai2c_8c_html_af46ed6c3913c335f228d88228591cbb7"><div class="ttname"><a href="i2c_8c.html#af46ed6c3913c335f228d88228591cbb7">rtc_setTimeAll</a></div><div class="ttdeci">void rtc_setTimeAll(uint8_t hours, uint8_t mins, uint8_t secs, uint8_t day, uint8_t date, uint8_t month, int16_t years)</div><div class="ttdef"><b>Definition:</b> <a href="i2c_8c_source.html#l00548">i2c.c:548</a></div></div>
<div class="ttc" id="ai2c_8c_html_ab1f61939509af43c803795ad5a76925c"><div class="ttname"><a href="i2c_8c.html#ab1f61939509af43c803795ad5a76925c">rtc_getTimeAll</a></div><div class="ttdeci">void rtc_getTimeAll(void)</div><div class="ttdef"><b>Definition:</b> <a href="i2c_8c_source.html#l00541">i2c.c:541</a></div></div>
<div class="ttc" id="aesp8266_8h_html"><div class="ttname"><a href="esp8266_8h.html">esp8266.h</a></div></div>
<div class="ttc" id="ai2c_8c_html_a5730d9445429351b9f750084c5cb5aae"><div class="ttname"><a href="i2c_8c.html#a5730d9445429351b9f750084c5cb5aae">i2c_init</a></div><div class="ttdeci">void i2c_init(void)</div><div class="ttdef"><b>Definition:</b> <a href="i2c_8c_source.html#l00038">i2c.c:38</a></div></div>
<div class="ttc" id="ai2c_8c_html_a12d7ae97b619468f26a6cd1dc2ded7f4"><div class="ttname"><a href="i2c_8c.html#a12d7ae97b619468f26a6cd1dc2ded7f4">convertBCD2Bytes</a></div><div class="ttdeci">uint8_t convertBCD2Bytes(uint8_t bcdByte, char *__HI, char *__LO)</div><div class="ttdef"><b>Definition:</b> <a href="i2c_8c_source.html#l00566">i2c.c:566</a></div></div>
<div class="ttc" id="ai2c_8h_html_aa51640d985382739c2811f8b69f308ae"><div class="ttname"><a href="i2c_8h.html#aa51640d985382739c2811f8b69f308ae">eeprom_buffer</a></div><div class="ttdeci">uint8_t eeprom_buffer[10]</div><div class="ttdef"><b>Definition:</b> <a href="i2c_8h_source.html#l00106">i2c.h:106</a></div></div>
<div class="ttc" id="ai2c_8c_html_aa3a26eff1590ec982188643bf07bb35b"><div class="ttname"><a href="i2c_8c.html#aa3a26eff1590ec982188643bf07bb35b">getHour</a></div><div class="ttdeci">uint8_t getHour(void)</div><div class="ttdef"><b>Definition:</b> <a href="i2c_8c_source.html#l00608">i2c.c:608</a></div></div>
<div class="ttc" id="ai2c_8h_html_afd2f05c788bfded35a08a7ff199d5c10"><div class="ttname"><a href="i2c_8h.html#afd2f05c788bfded35a08a7ff199d5c10">minus</a></div><div class="ttdeci">const char minus[]</div><div class="ttdef"><b>Definition:</b> <a href="i2c_8h_source.html#l00082">i2c.h:82</a></div></div>
<div class="ttc" id="ai2c_8c_html_a822140c93aab67d6a42a9969beabebcf"><div class="ttname"><a href="i2c_8c.html#a822140c93aab67d6a42a9969beabebcf">i2c_eeprom_initEeprom</a></div><div class="ttdeci">void i2c_eeprom_initEeprom(void)</div><div class="ttdef"><b>Definition:</b> <a href="i2c_8c_source.html#l00452">i2c.c:452</a></div></div>
<div class="ttc" id="ai2c_8c_html_ac04c5f5412a1b26bf1563d0cef269683"><div class="ttname"><a href="i2c_8c.html#ac04c5f5412a1b26bf1563d0cef269683">getAMPM</a></div><div class="ttdeci">uint8_t getAMPM(void)</div><div class="ttdef"><b>Definition:</b> <a href="i2c_8c_source.html#l00616">i2c.c:616</a></div></div>
<div class="ttc" id="ai2c_8h_html_ac7bc4c6b2054a016f7d53f237f1ebdd6"><div class="ttname"><a href="i2c_8h.html#ac7bc4c6b2054a016f7d53f237f1ebdd6">temp_pos</a></div><div class="ttdeci">const char temp_pos[]</div><div class="ttdef"><b>Definition:</b> <a href="i2c_8h_source.html#l00084">i2c.h:84</a></div></div>
<div class="ttc" id="ai2c_8h_html_a7c8aec3447e717abf7f853bd11b8a5ec"><div class="ttname"><a href="i2c_8h.html#a7c8aec3447e717abf7f853bd11b8a5ec">shift_line</a></div><div class="ttdeci">const char shift_line[]</div><div class="ttdef"><b>Definition:</b> <a href="i2c_8h_source.html#l00066">i2c.h:66</a></div></div>
<div class="ttc" id="ai2c_8c_html_ae66fdb4fe48ccaf1db63bbc1b3fb2c03"><div class="ttname"><a href="i2c_8c.html#ae66fdb4fe48ccaf1db63bbc1b3fb2c03">getMinutes</a></div><div class="ttdeci">uint8_t getMinutes(void)</div><div class="ttdef"><b>Definition:</b> <a href="i2c_8c_source.html#l00600">i2c.c:600</a></div></div>
<div class="ttc" id="astruct_t_i_m_e_html_acf81a9eff2e50cb602150a23febb266d"><div class="ttname"><a href="struct_t_i_m_e.html#acf81a9eff2e50cb602150a23febb266d">TIME::seconds</a></div><div class="ttdeci">uint8_t seconds</div><div class="ttdef"><b>Definition:</b> <a href="rtc_8h_source.html#l00046">rtc.h:46</a></div></div>
<div class="ttc" id="ai2c_8c_html_a64401883d716efd5212146992862e7e8"><div class="ttname"><a href="i2c_8c.html#a64401883d716efd5212146992862e7e8">i2c_rtc_Write</a></div><div class="ttdeci">void i2c_rtc_Write(uint8_t *rtcAddr, uint8_t value)</div><div class="ttdef"><b>Definition:</b> <a href="i2c_8c_source.html#l00531">i2c.c:531</a></div></div>
<div class="ttc" id="ai2c_8h_html_a9eec345fbe35bae76df320fc80e492d6"><div class="ttname"><a href="i2c_8h.html#a9eec345fbe35bae76df320fc80e492d6">tmp_string</a></div><div class="ttdeci">char tmp_string[0x0F]</div><div class="ttdef"><b>Definition:</b> <a href="i2c_8h_source.html#l00087">i2c.h:87</a></div></div>
<div class="ttc" id="ai2c_8h_html_ab33acfe5e102c73df9fd842d9a9757ef"><div class="ttname"><a href="i2c_8h.html#ab33acfe5e102c73df9fd842d9a9757ef">eeprom_init</a></div><div class="ttdeci">const char eeprom_init[]</div><div class="ttdef"><b>Definition:</b> <a href="i2c_8h_source.html#l00104">i2c.h:104</a></div></div>
<div class="ttc" id="astruct_t_i_m_e_html_a030c668a2df873e113bc6ea5526f28fd"><div class="ttname"><a href="struct_t_i_m_e.html#a030c668a2df873e113bc6ea5526f28fd">TIME::minutesAddr</a></div><div class="ttdeci">uint8_t minutesAddr</div><div class="ttdef"><b>Definition:</b> <a href="rtc_8h_source.html#l00047">rtc.h:47</a></div></div>
<div class="ttc" id="ai2c_8c_html_a44cb094ffb7aa06d88a71146c86dede0"><div class="ttname"><a href="i2c_8c.html#a44cb094ffb7aa06d88a71146c86dede0">convertByte2BCD</a></div><div class="ttdeci">uint8_t convertByte2BCD(uint8_t byte)</div><div class="ttdef"><b>Definition:</b> <a href="i2c_8c_source.html#l00582">i2c.c:582</a></div></div>
<div class="ttc" id="ai2c_8c_html_a765c99cb79df483416ca7323c16df72c"><div class="ttname"><a href="i2c_8c.html#a765c99cb79df483416ca7323c16df72c">i2c_eeprom_dumpLogData</a></div><div class="ttdeci">void i2c_eeprom_dumpLogData(void)</div><div class="ttdef"><b>Definition:</b> <a href="i2c_8c_source.html#l00459">i2c.c:459</a></div></div>
<div class="ttc" id="ai2c_8c_html_a6de2e3a4ee83d93f3743862e16dcf6d3"><div class="ttname"><a href="i2c_8c.html#a6de2e3a4ee83d93f3743862e16dcf6d3">getDay</a></div><div class="ttdeci">uint8_t getDay(void)</div><div class="ttdef"><b>Definition:</b> <a href="i2c_8c_source.html#l00626">i2c.c:626</a></div></div>
<div class="ttc" id="ai2c_8c_html_ac26c9d95dfa5cad2f457a88856e94165"><div class="ttname"><a href="i2c_8c.html#ac26c9d95dfa5cad2f457a88856e94165">i2c_eeprom_testData</a></div><div class="ttdeci">void i2c_eeprom_testData(void)</div><div class="ttdef"><b>Definition:</b> <a href="i2c_8c_source.html#l00420">i2c.c:420</a></div></div>
<div class="ttc" id="ai2c_8c_html_a4524baa32fdd90e664342c610dc1d177"><div class="ttname"><a href="i2c_8c.html#a4524baa32fdd90e664342c610dc1d177">i2c_master_stop</a></div><div class="ttdeci">void i2c_master_stop(void)</div><div class="ttdef"><b>Definition:</b> <a href="i2c_8c_source.html#l00209">i2c.c:209</a></div></div>
<div class="ttc" id="astruct_t_i_m_e_html_aaf16f1a35a80295ebba855ac071a9526"><div class="ttname"><a href="struct_t_i_m_e.html#aaf16f1a35a80295ebba855ac071a9526">TIME::yearAddr</a></div><div class="ttdeci">uint8_t yearAddr</div><div class="ttdef"><b>Definition:</b> <a href="rtc_8h_source.html#l00057">rtc.h:57</a></div></div>
<div class="ttc" id="ai2c_8h_html_a7fef1b6528dcbfcb92dee4a44d0559f3"><div class="ttname"><a href="i2c_8h.html#a7fef1b6528dcbfcb92dee4a44d0559f3">eeprom_test</a></div><div class="ttdeci">const char eeprom_test[]</div><div class="ttdef"><b>Definition:</b> <a href="i2c_8h_source.html#l00103">i2c.h:103</a></div></div>
<div class="ttc" id="ai2c_8c_html_ac69b8d8de566fa9d1ec2a74518e70af1"><div class="ttname"><a href="i2c_8c.html#ac69b8d8de566fa9d1ec2a74518e70af1">i2c_lcd_displayInit</a></div><div class="ttdeci">void i2c_lcd_displayInit(void)</div><div class="ttdef"><b>Definition:</b> <a href="i2c_8c_source.html#l00246">i2c.c:246</a></div></div>
<div class="ttc" id="ai2c_8c_html_a0ffbc3618da77afeaec223450985ce49"><div class="ttname"><a href="i2c_8c.html#a0ffbc3618da77afeaec223450985ce49">getReading</a></div><div class="ttdeci">void getReading(void)</div><div class="ttdef"><b>Definition:</b> <a href="i2c_8c_source.html#l00286">i2c.c:286</a></div></div>
<div class="ttc" id="ai2c_8c_html_a427111856511ff3f394b035dbb151600"><div class="ttname"><a href="i2c_8c.html#a427111856511ff3f394b035dbb151600">getSeconds</a></div><div class="ttdeci">uint8_t getSeconds(void)</div><div class="ttdef"><b>Definition:</b> <a href="i2c_8c_source.html#l00591">i2c.c:591</a></div></div>
<div class="ttc" id="astruct_t_i_m_e_html_a5e5877cb38d93e572f5df856520d3ff4"><div class="ttname"><a href="struct_t_i_m_e.html#a5e5877cb38d93e572f5df856520d3ff4">TIME::hoursAddr</a></div><div class="ttdeci">uint8_t hoursAddr</div><div class="ttdef"><b>Definition:</b> <a href="rtc_8h_source.html#l00049">rtc.h:49</a></div></div>
<div class="ttc" id="ai2c_8c_html_aa9e8b7dcd8d6aa73ea63411e6914073e"><div class="ttname"><a href="i2c_8c.html#aa9e8b7dcd8d6aa73ea63411e6914073e">setDay</a></div><div class="ttdeci">void setDay(uint8_t day)</div><div class="ttdef"><b>Definition:</b> <a href="i2c_8c_source.html#l00627">i2c.c:627</a></div></div>
<div class="ttc" id="ai2c_8h_html_a8683f936ecb5cd7b43c33a01a435a7ba"><div class="ttname"><a href="i2c_8h.html#a8683f936ecb5cd7b43c33a01a435a7ba">display_addr</a></div><div class="ttdeci">const uint8_t display_addr</div><div class="ttdef"><b>Definition:</b> <a href="i2c_8h_source.html#l00062">i2c.h:62</a></div></div>
<div class="ttc" id="artc_8h_html_aaddfe18588c54fa64170fce51feed094"><div class="ttname"><a href="rtc_8h.html#aaddfe18588c54fa64170fce51feed094">rtc_addr</a></div><div class="ttdeci">const uint8_t rtc_addr</div><div class="ttdef"><b>Definition:</b> <a href="rtc_8h_source.html#l00041">rtc.h:41</a></div></div>
<div class="ttc" id="ai2c_8c_html_ad6a1e92a896b2d26e648625ce6b3861e"><div class="ttname"><a href="i2c_8c.html#ad6a1e92a896b2d26e648625ce6b3861e">setMonth</a></div><div class="ttdeci">void setMonth(uint8_t month)</div><div class="ttdef"><b>Definition:</b> <a href="i2c_8c_source.html#l00634">i2c.c:634</a></div></div>
<div class="ttc" id="ai2c_8c_html_a8a67e34b654397f7e419889fe802dbff"><div class="ttname"><a href="i2c_8c.html#a8a67e34b654397f7e419889fe802dbff">setYear</a></div><div class="ttdeci">void setYear(uint8_t years)</div><div class="ttdef"><b>Definition:</b> <a href="i2c_8c_source.html#l00641">i2c.c:641</a></div></div>
<div class="ttc" id="ai2c_8h_html"><div class="ttname"><a href="i2c_8h.html">i2c.h</a></div></div>
<div class="ttc" id="ai2c_8c_html_a2afd8da70c8c74e56659da3dd6f60dd0"><div class="ttname"><a href="i2c_8c.html#a2afd8da70c8c74e56659da3dd6f60dd0">i2c_write_serial</a></div><div class="ttdeci">void i2c_write_serial(uint8_t addr, char *data, uint8_t length)</div><div class="ttdef"><b>Definition:</b> <a href="i2c_8c_source.html#l00064">i2c.c:64</a></div></div>
<div class="ttc" id="ai2c_8c_html_a801e6fe14e7cf1f1e51e219b8593c8d4"><div class="ttname"><a href="i2c_8c.html#a801e6fe14e7cf1f1e51e219b8593c8d4">updateMoist</a></div><div class="ttdeci">void updateMoist(uint8_t moist)</div><div class="ttdef"><b>Definition:</b> <a href="i2c_8c_source.html#l00382">i2c.c:382</a></div></div>
<div class="ttc" id="astruct_t_i_m_e_html_a638f9e3ed4d0e4d5faac011cdf72aa31"><div class="ttname"><a href="struct_t_i_m_e.html#a638f9e3ed4d0e4d5faac011cdf72aa31">TIME::timePMnAM</a></div><div class="ttdeci">bool timePMnAM</div><div class="ttdef"><b>Definition:</b> <a href="rtc_8h_source.html#l00064">rtc.h:64</a></div></div>
<div class="ttc" id="ai2c_8c_html_ae60d3dfb3e2bcfacd1bbca9debd6e35c"><div class="ttname"><a href="i2c_8c.html#ae60d3dfb3e2bcfacd1bbca9debd6e35c">i2c_master_nack</a></div><div class="ttdeci">void i2c_master_nack(void)</div><div class="ttdef"><b>Definition:</b> <a href="i2c_8c_source.html#l00226">i2c.c:226</a></div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="i2c_8c.html">i2c.c</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
